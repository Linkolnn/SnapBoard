# –≠—Ç–∞–ø 4: –ú–æ–¥—É–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (Profile) ‚úÖ

> **–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
> 
> **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –≠—Ç–∞–ø 3 (Auth) ‚úÖ
> 
> **–°–µ—Ä–≤–µ—Ä:** http://localhost:3001/api
> 
> **Swagger:** http://localhost:3001/api/docs

---

## üéØ –¶–µ–ª—å —ç—Ç–∞–ø–∞

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –ø–æ–ª—É—á–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è, —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è, –∑–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞, —É–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.

---

## üìö –ì–ª–æ—Å—Å–∞—Ä–∏–π (–¥–ª—è frontend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)

### üë§ Profile vs User

**User** ‚Äî —Å—É—â–Ω–æ—Å—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–∫–ª—é—á–∞—è –ø–∞—Ä–æ–ª—å –∏ —Ç–æ–∫–µ–Ω—ã.

**Profile** ‚Äî –ø—É–±–ª–∏—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –±–µ–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–∞—Ä–æ–ª—å, refresh token).

### üìä Stats (–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)

**Stats** ‚Äî –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –∫–æ–Ω—Ç–µ–Ω—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å–æ–∫
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ

### üñºÔ∏è Avatar

**Avatar** ‚Äî –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –•—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ URL –∫ —Ñ–∞–π–ª—É –≤ –ø–∞–ø–∫–µ uploads.

### üîê Password Change

–ü—Ä–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è —Ç—Ä–µ–±—É–µ—Ç—Å—è:
1. –¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å (–¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
2. –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)

### ‚ö†Ô∏è Account Deletion

–£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ ‚Äî –Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è. –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:
- –£–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –¥–æ—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –£–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –£–¥–∞–ª—è–µ—Ç—Å—è –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
- –û—á–∏—â–∞—é—Ç—Å—è cookies

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
backend/src/modules/users/
‚îú‚îÄ‚îÄ users.module.ts              # –ú–æ–¥—É–ª—å (–æ–±–Ω–æ–≤–∏—Ç—å)
‚îú‚îÄ‚îÄ users.controller.ts          # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø—Ä–æ—Ñ–∏–ª—è (—Å–æ–∑–¥–∞—Ç—å)
‚îú‚îÄ‚îÄ users.service.ts             # –°–µ—Ä–≤–∏—Å (—Ä–∞—Å—à–∏—Ä–∏—Ç—å)
‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îî‚îÄ‚îÄ user.entity.ts           # Entity (—É–∂–µ –µ—Å—Ç—å)
‚îî‚îÄ‚îÄ dto/
    ‚îú‚îÄ‚îÄ index.ts                 # –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö DTO
    ‚îú‚îÄ‚îÄ update-profile.dto.ts    # DTO –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
    ‚îú‚îÄ‚îÄ change-password.dto.ts   # DTO —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
    ‚îú‚îÄ‚îÄ profile-response.dto.ts  # DTO –æ—Ç–≤–µ—Ç–∞ –ø—Ä–æ—Ñ–∏–ª—è
    ‚îî‚îÄ‚îÄ stats-response.dto.ts    # DTO —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```

---

## üìù API Endpoints

### GET /api/profile

–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Headers:** `Cookie: access_token=...` –∏–ª–∏ `Authorization: Bearer <token>`

**Response (200):**
```json
{
  "id": "uuid",
  "email": "user@example.com",
  "username": "johndoe",
  "name": "John Doe",
  "bio": "Frontend developer",
  "avatar": "/uploads/avatars/uuid.jpg",
  "createdAt": "2024-01-01T00:00:00.000Z"
}
```

---

### PUT /api/profile

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (–∏–º—è, bio).

**Headers:** `Cookie: access_token=...`

**Request:**
```json
{
  "name": "John Smith",
  "bio": "Full-stack developer"
}
```

**Response (200):**
```json
{
  "id": "uuid",
  "email": "user@example.com",
  "username": "johndoe",
  "name": "John Smith",
  "bio": "Full-stack developer",
  "avatar": "/uploads/avatars/uuid.jpg",
  "createdAt": "2024-01-01T00:00:00.000Z"
}
```

---

### PUT /api/profile/password

–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è.

**Headers:** `Cookie: access_token=...`

**Request:**
```json
{
  "currentPassword": "oldPassword123",
  "newPassword": "newPassword456"
}
```

**Response (200):**
```json
{
  "message": "–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω—ë–Ω"
}
```

**Errors:**
- `400` ‚Äî –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π
- `401` ‚Äî –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å

---

### POST /api/profile/avatar

–ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞.

**Headers:** `Cookie: access_token=...`

**Request:** `multipart/form-data`
- `file` ‚Äî –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (jpeg, png, webp, gif), –º–∞–∫—Å. 5MB

**Response (200):**
```json
{
  "avatar": "/uploads/avatars/uuid-1704067200000.jpg",
  "message": "–ê–≤–∞—Ç–∞—Ä –æ–±–Ω–æ–≤–ª—ë–Ω"
}
```

**Errors:**
- `400` ‚Äî –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞
- `400` ‚Äî –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π

---

### DELETE /api/profile/avatar

–£–¥–∞–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞.

**Headers:** `Cookie: access_token=...`

**Response (200):**
```json
{
  "message": "–ê–≤–∞—Ç–∞—Ä —É–¥–∞–ª—ë–Ω"
}
```

---

### DELETE /api/profile

–£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞.

**Headers:** `Cookie: access_token=...`

**Request:**
```json
{
  "password": "currentPassword123"
}
```

**Response (200):**
```json
{
  "message": "–ê–∫–∫–∞—É–Ω—Ç —É–¥–∞–ª—ë–Ω"
}
```

**Cookies:** –û—á–∏—â–∞—é—Ç—Å—è `access_token` –∏ `refresh_token`

**Errors:**
- `401` ‚Äî –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å

---

### GET /api/profile/stats

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Headers:** `Cookie: access_token=...`

**Response (200):**
```json
{
  "boardsCount": 5,
  "imagesCount": 42,
  "favoritesCount": 18
}
```

---

### GET /api/profile/boards

–î–æ—Å–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤–∫–ª—é—á–∞—è –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ).

**Headers:** `Cookie: access_token=...`

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page` ‚Äî –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (default: 1)
- `pageSize` ‚Äî —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (default: 12, max: 50)

**Response (200):**
```json
{
  "items": [
    {
      "id": "uuid",
      "title": "Inspiration",
      "description": "My design inspiration",
      "coverImage": "/uploads/images/cover.jpg",
      "isPrivate": false,
      "imagesCount": 15,
      "createdAt": "2024-01-01T00:00:00.000Z"
    }
  ],
  "page": 1,
  "pageSize": 12,
  "totalItems": 5,
  "totalPages": 1,
  "hasMore": false
}
```

---

### GET /api/profile/images

–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Headers:** `Cookie: access_token=...`

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page` ‚Äî –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (default: 1)
- `pageSize` ‚Äî —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (default: 12, max: 50)

**Response (200):**
```json
{
  "items": [
    {
      "id": "uuid",
      "url": "/uploads/images/image.jpg",
      "title": "Sunset",
      "description": "Beautiful sunset",
      "tags": ["nature", "sunset"],
      "width": 1920,
      "height": 1080,
      "createdAt": "2024-01-01T00:00:00.000Z"
    }
  ],
  "page": 1,
  "pageSize": 12,
  "totalItems": 42,
  "totalPages": 4,
  "hasMore": true
}
```

---

## üíª –†–µ–∞–ª–∏–∑–∞—Ü–∏—è


### DTOs

#### update-profile.dto.ts

```typescript
import { IsOptional, IsString, MinLength, MaxLength } from 'class-validator';
import { ApiProperty } from '@nestjs/swagger';

/**
 * DTO –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
 */
export class UpdateProfileDto {
  @ApiProperty({
    example: 'John Doe',
    description: '–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è (2-100 —Å–∏–º–≤–æ–ª–æ–≤)',
    required: false,
  })
  @IsOptional()
  @IsString()
  @MinLength(2, { message: '–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞' })
  @MaxLength(100, { message: '–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∞–∫—Å–∏–º—É–º 100 —Å–∏–º–≤–æ–ª–æ–≤' })
  name?: string;

  @ApiProperty({
    example: 'Frontend developer from Moscow',
    description: '–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (–¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤)',
    required: false,
  })
  @IsOptional()
  @IsString()
  @MaxLength(500, { message: 'Bio –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∞–∫—Å–∏–º—É–º 500 —Å–∏–º–≤–æ–ª–æ–≤' })
  bio?: string;
}
```

#### change-password.dto.ts

```typescript
import { IsString, MinLength, MaxLength } from 'class-validator';
import { ApiProperty } from '@nestjs/swagger';

/**
 * DTO –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
 */
export class ChangePasswordDto {
  @ApiProperty({
    example: 'oldPassword123',
    description: '–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å',
  })
  @IsString()
  @MinLength(1, { message: '–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω' })
  currentPassword: string;

  @ApiProperty({
    example: 'newPassword456',
    description: '–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)',
  })
  @IsString()
  @MinLength(6, { message: '–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤' })
  @MaxLength(100, { message: '–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π' })
  newPassword: string;
}
```

#### delete-account.dto.ts

```typescript
import { IsString, MinLength } from 'class-validator';
import { ApiProperty } from '@nestjs/swagger';

/**
 * DTO –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞
 */
export class DeleteAccountDto {
  @ApiProperty({
    example: 'currentPassword123',
    description: '–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è',
  })
  @IsString()
  @MinLength(1, { message: '–ü–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω' })
  password: string;
}
```

#### profile-response.dto.ts

```typescript
import { ApiProperty } from '@nestjs/swagger';

/**
 * DTO –æ—Ç–≤–µ—Ç–∞ –ø—Ä–æ—Ñ–∏–ª—è
 */
export class ProfileResponseDto {
  @ApiProperty({ example: 'uuid' })
  id: string;

  @ApiProperty({ example: 'user@example.com' })
  email: string;

  @ApiProperty({ example: 'johndoe' })
  username: string;

  @ApiProperty({ example: 'John Doe', nullable: true })
  name: string | null;

  @ApiProperty({ example: 'Frontend developer', nullable: true })
  bio: string | null;

  @ApiProperty({ example: '/uploads/avatars/uuid.jpg', nullable: true })
  avatar: string | null;

  @ApiProperty({ example: '2024-01-01T00:00:00.000Z' })
  createdAt: Date;
}
```

#### stats-response.dto.ts

```typescript
import { ApiProperty } from '@nestjs/swagger';

/**
 * DTO —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 */
export class StatsResponseDto {
  @ApiProperty({ example: 5, description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å–æ–∫' })
  boardsCount: number;

  @ApiProperty({ example: 42, description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π' })
  imagesCount: number;

  @ApiProperty({ example: 18, description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ' })
  favoritesCount: number;
}
```

#### dto/index.ts

```typescript
export * from './update-profile.dto';
export * from './change-password.dto';
export * from './delete-account.dto';
export * from './profile-response.dto';
export * from './stats-response.dto';
```

---

### users.service.ts (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π)

```typescript
import { Injectable, ConflictException, UnauthorizedException, NotFoundException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import * as bcrypt from 'bcrypt';
import * as fs from 'fs/promises';
import * as path from 'path';
import { User } from './entities/user.entity';
import { RegisterDto } from '../auth/dto/register.dto';
import { UpdateProfileDto, ChangePasswordDto } from './dto';

/**
 * –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
 */
@Injectable()
export class UsersService {
  constructor(
    @InjectRepository(User)
    private usersRepository: Repository<User>,
  ) {}

  // ==================== AUTH METHODS (—É–∂–µ –µ—Å—Ç—å) ====================

  /**
   * –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  async create(registerDto: RegisterDto): Promise<User> {
    const existingByEmail = await this.usersRepository.findOne({
      where: { email: registerDto.email },
    });
    
    if (existingByEmail) {
      throw new ConflictException('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
    }

    const existingByUsername = await this.usersRepository.findOne({
      where: { username: registerDto.username },
    });
    
    if (existingByUsername) {
      throw new ConflictException('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º username —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
    }

    const passwordHash = await bcrypt.hash(registerDto.password, 10);

    const user = this.usersRepository.create({
      email: registerDto.email,
      username: registerDto.username,
      passwordHash,
      name: registerDto.name ?? null,
    });

    return await this.usersRepository.save(user);
  }

  async findById(id: string): Promise<User | null> {
    return this.usersRepository.findOne({ where: { id } });
  }

  async findByEmail(email: string): Promise<User | null> {
    return this.usersRepository.findOne({ where: { email } });
  }

  async findByUsername(username: string): Promise<User | null> {
    return this.usersRepository.findOne({ where: { username } });
  }

  async updateRefreshToken(userId: string, refreshToken: string | null): Promise<void> {
    await this.usersRepository.update(userId, { refreshToken: refreshToken ?? undefined });
  }

  async validatePassword(user: User, password: string): Promise<boolean> {
    return bcrypt.compare(password, user.passwordHash);
  }

  // ==================== PROFILE METHODS (–Ω–æ–≤—ã–µ) ====================

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  async getProfile(userId: string): Promise<User> {
    const user = await this.findById(userId);
    
    if (!user) {
      throw new NotFoundException('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
    }

    return user;
  }

  /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
   */
  async updateProfile(userId: string, updateDto: UpdateProfileDto): Promise<User> {
    const user = await this.findById(userId);
    
    if (!user) {
      throw new NotFoundException('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—è
    if (updateDto.name !== undefined) {
      user.name = updateDto.name || null;
    }
    if (updateDto.bio !== undefined) {
      user.bio = updateDto.bio || null;
    }

    return await this.usersRepository.save(user);
  }

  /**
   * –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
   */
  async changePassword(userId: string, changePasswordDto: ChangePasswordDto): Promise<void> {
    const user = await this.findById(userId);
    
    if (!user) {
      throw new NotFoundException('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å
    const isPasswordValid = await this.validatePassword(user, changePasswordDto.currentPassword);
    
    if (!isPasswordValid) {
      throw new UnauthorizedException('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å');
    }

    // –•–µ—à–∏—Ä—É–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
    user.passwordHash = await bcrypt.hash(changePasswordDto.newPassword, 10);
    await this.usersRepository.save(user);
  }

  /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞
   */
  async updateAvatar(userId: string, avatarPath: string): Promise<User> {
    const user = await this.findById(userId);
    
    if (!user) {
      throw new NotFoundException('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
    }

    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –∞–≤–∞—Ç–∞—Ä –µ—Å–ª–∏ –µ—Å—Ç—å
    if (user.avatar) {
      await this.deleteAvatarFile(user.avatar);
    }

    user.avatar = avatarPath;
    return await this.usersRepository.save(user);
  }

  /**
   * –£–¥–∞–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞
   */
  async removeAvatar(userId: string): Promise<void> {
    const user = await this.findById(userId);
    
    if (!user) {
      throw new NotFoundException('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
    }

    if (user.avatar) {
      await this.deleteAvatarFile(user.avatar);
      user.avatar = null;
      await this.usersRepository.save(user);
    }
  }

  /**
   * –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
   */
  async deleteAccount(userId: string, password: string): Promise<void> {
    const user = await this.findById(userId);
    
    if (!user) {
      throw new NotFoundException('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–æ–ª—å
    const isPasswordValid = await this.validatePassword(user, password);
    
    if (!isPasswordValid) {
      throw new UnauthorizedException('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
    }

    // –£–¥–∞–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä –µ—Å–ª–∏ –µ—Å—Ç—å
    if (user.avatar) {
      await this.deleteAvatarFile(user.avatar);
    }

    // –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–∞—Å–∫–∞–¥–Ω–æ —É–¥–∞–ª—è—Ç—Å—è –¥–æ—Å–∫–∏, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∏–∑–±—Ä–∞–Ω–Ω–æ–µ)
    await this.usersRepository.remove(user);
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  async getStats(userId: string): Promise<{ boardsCount: number; imagesCount: number; favoritesCount: number }> {
    const user = await this.usersRepository.findOne({
      where: { id: userId },
      relations: ['boards', 'images', 'favorites'],
    });

    if (!user) {
      throw new NotFoundException('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
    }

    return {
      boardsCount: user.boards?.length || 0,
      imagesCount: user.images?.length || 0,
      favoritesCount: user.favorites?.length || 0,
    };
  }

  // ==================== PRIVATE METHODS ====================

  /**
   * –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∞–≤–∞—Ç–∞—Ä–∞
   */
  private async deleteAvatarFile(avatarPath: string): Promise<void> {
    try {
      // avatarPath: /uploads/avatars/filename.jpg
      const fullPath = path.join(process.cwd(), avatarPath);
      await fs.unlink(fullPath);
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫—É –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
      console.warn(`Failed to delete avatar file: ${avatarPath}`);
    }
  }
}
```


---

### users.controller.ts

```typescript
import {
  Controller,
  Get,
  Put,
  Post,
  Delete,
  Body,
  Res,
  UseGuards,
  UseInterceptors,
  UploadedFile,
  ParseFilePipe,
  MaxFileSizeValidator,
  FileTypeValidator,
  HttpCode,
  HttpStatus,
  Query,
} from '@nestjs/common';
import { FileInterceptor } from '@nestjs/platform-express';
import type { Response } from 'express';
import { diskStorage } from 'multer';
import { extname } from 'path';
import { v4 as uuidv4 } from 'uuid';
import {
  ApiTags,
  ApiOperation,
  ApiResponse,
  ApiBearerAuth,
  ApiConsumes,
  ApiBody,
  ApiQuery,
} from '@nestjs/swagger';
import { UsersService } from './users.service';
import {
  UpdateProfileDto,
  ChangePasswordDto,
  DeleteAccountDto,
  ProfileResponseDto,
  StatsResponseDto,
} from './dto';
import { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';
import { CurrentUser } from '../auth/decorators/current-user.decorator';

/**
 * –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 * 
 * API Endpoints:
 * GET    /api/profile           ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
 * PUT    /api/profile           ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
 * PUT    /api/profile/password  ‚Äî —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
 * POST   /api/profile/avatar    ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä
 * DELETE /api/profile/avatar    ‚Äî —É–¥–∞–ª–∏—Ç—å –∞–≤–∞—Ç–∞—Ä
 * DELETE /api/profile           ‚Äî —É–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
 * GET    /api/profile/stats     ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
 * GET    /api/profile/boards    ‚Äî –¥–æ—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 * GET    /api/profile/images    ‚Äî –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 */
@ApiTags('Profile')
@ApiBearerAuth()
@UseGuards(JwtAuthGuard)
@Controller('profile')
export class UsersController {
  constructor(private usersService: UsersService) {}

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  @Get()
  @ApiOperation({ summary: '–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å' })
  @ApiResponse({ status: 200, description: '–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', type: ProfileResponseDto })
  @ApiResponse({ status: 401, description: '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' })
  async getProfile(@CurrentUser('userId') userId: string) {
    const user = await this.usersService.getProfile(userId);
    return this.sanitizeUser(user);
  }

  /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
   */
  @Put()
  @ApiOperation({ summary: '–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å' })
  @ApiResponse({ status: 200, description: '–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω', type: ProfileResponseDto })
  @ApiResponse({ status: 401, description: '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' })
  async updateProfile(
    @CurrentUser('userId') userId: string,
    @Body() updateDto: UpdateProfileDto,
  ) {
    const user = await this.usersService.updateProfile(userId, updateDto);
    return this.sanitizeUser(user);
  }

  /**
   * –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
   */
  @Put('password')
  @HttpCode(HttpStatus.OK)
  @ApiOperation({ summary: '–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å' })
  @ApiResponse({ status: 200, description: '–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω—ë–Ω' })
  @ApiResponse({ status: 401, description: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å' })
  async changePassword(
    @CurrentUser('userId') userId: string,
    @Body() changePasswordDto: ChangePasswordDto,
  ) {
    await this.usersService.changePassword(userId, changePasswordDto);
    return { message: '–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω—ë–Ω' };
  }

  /**
   * –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞
   */
  @Post('avatar')
  @UseInterceptors(
    FileInterceptor('file', {
      storage: diskStorage({
        destination: './uploads/avatars',
        filename: (req, file, callback) => {
          const uniqueName = `${uuidv4()}${extname(file.originalname)}`;
          callback(null, uniqueName);
        },
      }),
    }),
  )
  @ApiOperation({ summary: '–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä' })
  @ApiConsumes('multipart/form-data')
  @ApiBody({
    schema: {
      type: 'object',
      properties: {
        file: {
          type: 'string',
          format: 'binary',
          description: '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (jpeg, png, webp, gif), –º–∞–∫—Å. 5MB',
        },
      },
    },
  })
  @ApiResponse({ status: 200, description: '–ê–≤–∞—Ç–∞—Ä –∑–∞–≥—Ä—É–∂–µ–Ω' })
  @ApiResponse({ status: 400, description: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞' })
  async uploadAvatar(
    @CurrentUser('userId') userId: string,
    @UploadedFile(
      new ParseFilePipe({
        validators: [
          new MaxFileSizeValidator({ maxSize: 5 * 1024 * 1024 }), // 5MB
          new FileTypeValidator({ fileType: /^image\/(jpeg|png|webp|gif)$/ }),
        ],
      }),
    )
    file: Express.Multer.File,
  ) {
    const avatarPath = `/uploads/avatars/${file.filename}`;
    await this.usersService.updateAvatar(userId, avatarPath);
    return {
      avatar: avatarPath,
      message: '–ê–≤–∞—Ç–∞—Ä –æ–±–Ω–æ–≤–ª—ë–Ω',
    };
  }

  /**
   * –£–¥–∞–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞
   */
  @Delete('avatar')
  @HttpCode(HttpStatus.OK)
  @ApiOperation({ summary: '–£–¥–∞–ª–∏—Ç—å –∞–≤–∞—Ç–∞—Ä' })
  @ApiResponse({ status: 200, description: '–ê–≤–∞—Ç–∞—Ä —É–¥–∞–ª—ë–Ω' })
  async removeAvatar(@CurrentUser('userId') userId: string) {
    await this.usersService.removeAvatar(userId);
    return { message: '–ê–≤–∞—Ç–∞—Ä —É–¥–∞–ª—ë–Ω' };
  }

  /**
   * –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
   */
  @Delete()
  @HttpCode(HttpStatus.OK)
  @ApiOperation({ summary: '–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç' })
  @ApiResponse({ status: 200, description: '–ê–∫–∫–∞—É–Ω—Ç —É–¥–∞–ª—ë–Ω' })
  @ApiResponse({ status: 401, description: '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å' })
  async deleteAccount(
    @CurrentUser('userId') userId: string,
    @Body() deleteAccountDto: DeleteAccountDto,
    @Res({ passthrough: true }) res: Response,
  ) {
    await this.usersService.deleteAccount(userId, deleteAccountDto.password);
    
    // –û—á–∏—â–∞–µ–º cookies
    res.clearCookie('access_token', { path: '/' });
    res.clearCookie('refresh_token', { path: '/' });
    
    return { message: '–ê–∫–∫–∞—É–Ω—Ç —É–¥–∞–ª—ë–Ω' };
  }

  /**
   * –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  @Get('stats')
  @ApiOperation({ summary: '–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É' })
  @ApiResponse({ status: 200, description: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', type: StatsResponseDto })
  async getStats(@CurrentUser('userId') userId: string) {
    return this.usersService.getStats(userId);
  }

  /**
   * –î–æ—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   * –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç –≤ BoardsController
   */
  @Get('boards')
  @ApiOperation({ summary: '–ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' })
  @ApiQuery({ name: 'page', required: false, type: Number })
  @ApiQuery({ name: 'pageSize', required: false, type: Number })
  @ApiResponse({ status: 200, description: '–°–ø–∏—Å–æ–∫ –¥–æ—Å–æ–∫' })
  async getBoards(
    @CurrentUser('userId') userId: string,
    @Query('page') page?: number,
    @Query('pageSize') pageSize?: number,
  ) {
    // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ BoardsService
    return {
      items: [],
      page: page || 1,
      pageSize: pageSize || 12,
      totalItems: 0,
      totalPages: 0,
      hasMore: false,
    };
  }

  /**
   * –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   * –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç –≤ ImagesController
   */
  @Get('images')
  @ApiOperation({ summary: '–ü–æ–ª—É—á–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' })
  @ApiQuery({ name: 'page', required: false, type: Number })
  @ApiQuery({ name: 'pageSize', required: false, type: Number })
  @ApiResponse({ status: 200, description: '–°–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π' })
  async getImages(
    @CurrentUser('userId') userId: string,
    @Query('page') page?: number,
    @Query('pageSize') pageSize?: number,
  ) {
    // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ ImagesService
    return {
      items: [],
      page: page || 1,
      pageSize: pageSize || 12,
      totalItems: 0,
      totalPages: 0,
      hasMore: false,
    };
  }

  // ==================== PRIVATE METHODS ====================

  /**
   * –£–¥–∞–ª–µ–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ–±—ä–µ–∫—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  private sanitizeUser(user: any) {
    return {
      id: user.id,
      email: user.email,
      username: user.username,
      name: user.name,
      bio: user.bio,
      avatar: user.avatar,
      createdAt: user.createdAt,
    };
  }
}
```

---

### users.module.ts (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π)

```typescript
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { MulterModule } from '@nestjs/platform-express';
import { User } from './entities/user.entity';
import { UsersService } from './users.service';
import { UsersController } from './users.controller';

/**
 * –ú–æ–¥—É–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
 */
@Module({
  imports: [
    TypeOrmModule.forFeature([User]),
    MulterModule.register({
      dest: './uploads/avatars',
    }),
  ],
  controllers: [UsersController],
  providers: [UsersService],
  exports: [UsersService],
})
export class UsersModule {}
```


---

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤

```bash
mkdir -p uploads/avatars
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ uuid (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

```bash
npm install uuid
npm install -D @types/uuid
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –≤ main.ts

```typescript
// backend/src/main.ts
import { NestFactory } from '@nestjs/core';
import { NestExpressApplication } from '@nestjs/platform-express';
import { join } from 'path';
// ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã

async function bootstrap() {
  const app = await NestFactory.create<NestExpressApplication>(AppModule);
  
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
  
  // –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (uploads)
  app.useStaticAssets(join(__dirname, '..', 'uploads'), {
    prefix: '/uploads/',
  });
  
  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß–µ—Ä–µ–∑ Swagger UI

–û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3001/api/docs

### –ß–µ—Ä–µ–∑ curl

```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
curl http://localhost:3001/api/profile \
  -b cookies.txt

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
curl -X PUT http://localhost:3001/api/profile \
  -H "Content-Type: application/json" \
  -d '{"name":"John Smith","bio":"Full-stack developer"}' \
  -b cookies.txt

# –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
curl -X PUT http://localhost:3001/api/profile/password \
  -H "Content-Type: application/json" \
  -d '{"currentPassword":"password123","newPassword":"newPassword456"}' \
  -b cookies.txt

# –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞
curl -X POST http://localhost:3001/api/profile/avatar \
  -F "file=@/path/to/avatar.jpg" \
  -b cookies.txt

# –£–¥–∞–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞
curl -X DELETE http://localhost:3001/api/profile/avatar \
  -b cookies.txt

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
curl http://localhost:3001/api/profile/stats \
  -b cookies.txt

# –î–æ—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl "http://localhost:3001/api/profile/boards?page=1&pageSize=12" \
  -b cookies.txt

# –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl "http://localhost:3001/api/profile/images?page=1&pageSize=12" \
  -b cookies.txt

# –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
curl -X DELETE http://localhost:3001/api/profile \
  -H "Content-Type: application/json" \
  -d '{"password":"password123"}' \
  -b cookies.txt
```

---

## üîÑ –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ—Ñ–∏–ª—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         –ü–û–õ–£–ß–ï–ù–ò–ï –ü–†–û–§–ò–õ–Ø                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  Frontend                          Backend                              ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                         ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                              ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  GET /api/profile ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫  JwtAuthGuard                         ‚îÇ
‚îÇ  Cookie: access_token              ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ                                    UsersService.getProfile()            ‚îÇ
‚îÇ                                    ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ  ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ { id, email, username, ... }         ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         –ó–ê–ì–†–£–ó–ö–ê –ê–í–ê–¢–ê–†–ê                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  Frontend                          Backend                              ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                         ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                              ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  POST /api/profile/avatar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫  JwtAuthGuard                         ‚îÇ
‚îÇ  multipart/form-data               ‚îÇ                                    ‚îÇ
‚îÇ  Cookie: access_token              ‚ñº                                    ‚îÇ
‚îÇ                                    FileInterceptor (Multer)             ‚îÇ
‚îÇ                                    ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ                                    –í–∞–ª–∏–¥–∞—Ü–∏—è (—Ä–∞–∑–º–µ—Ä, —Ç–∏–ø)              ‚îÇ
‚îÇ                                    ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ                                    –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ /uploads/avatars/       ‚îÇ
‚îÇ                                    ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ                                    UsersService.updateAvatar()          ‚îÇ
‚îÇ                                    ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ  ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ { avatar: "/uploads/avatars/..." }   ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         –£–î–ê–õ–ï–ù–ò–ï –ê–ö–ö–ê–£–ù–¢–ê                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  Frontend                          Backend                              ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                         ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                              ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  DELETE /api/profile ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫  JwtAuthGuard                         ‚îÇ
‚îÇ  { password: "..." }               ‚îÇ                                    ‚îÇ
‚îÇ  Cookie: access_token              ‚ñº                                    ‚îÇ
‚îÇ                                    –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è                      ‚îÇ
‚îÇ                                    ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ                                    –£–¥–∞–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞ (—Ñ–∞–π–ª)              ‚îÇ
‚îÇ                                    ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ                                    –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–∞—Å–∫–∞–¥)       ‚îÇ
‚îÇ                                    ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ  ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Clear-Cookie: access_token           ‚îÇ
‚îÇ  { message: "–ê–∫–∫–∞—É–Ω—Ç —É–¥–∞–ª—ë–Ω" }     Clear-Cookie: refresh_token          ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

1. **Multer** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ multipart/form-data
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ (5MB) –∏ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
3. **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞** ‚Äî UUID –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
4. **–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ** ‚Äî –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞ —Å—Ç–∞—Ä—ã–π —É–¥–∞–ª—è–µ—Ç—Å—è

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è** ‚Äî –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è –∏ —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞
2. **–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** ‚Äî –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
3. **–û—á–∏—Å—Ç–∫–∞ cookies** ‚Äî –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞

### –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã

–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º —Ñ–∞–π–ª–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `useStaticAssets` –≤ `main.ts`.

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç

- [x] DTO —Å–æ–∑–¥–∞–Ω—ã
- [x] UsersService —Ä–∞—Å—à–∏—Ä–µ–Ω
- [x] UsersController —Å–æ–∑–¥–∞–Ω
- [x] UsersModule –æ–±–Ω–æ–≤–ª—ë–Ω
- [x] –ü–∞–ø–∫–∞ uploads/avatars —Å–æ–∑–¥–∞–Ω–∞
- [x] –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [x] Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ curl/Swagger

---

## üìã –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö —ç—Ç–∞–ø–æ–≤

| Endpoint | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å | –°—Ç–∞—Ç—É—Å |
|----------|-------------|--------|
| GET /api/profile/boards | BoardsService | –≠—Ç–∞–ø 5 |
| GET /api/profile/images | ImagesService | –≠—Ç–∞–ø 6 |
| GET /api/profile/stats | –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã | –ß–∞—Å—Ç–∏—á–Ω–æ |

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Endpoints `/profile/boards` –∏ `/profile/images` –±—É–¥—É—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π (–≠—Ç–∞–ø—ã 5 –∏ 6). –°–µ–π—á–∞—Å –æ–Ω–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø—É—Å—Ç—ã–µ —Å–ø–∏—Å–∫–∏.
