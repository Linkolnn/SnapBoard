# –≠—Ç–∞–ø 6: –ú–æ–¥—É–ª—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (Images)

> **–°—Ç–∞—Ç—É—Å:** –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
> 
> **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –≠—Ç–∞–ø 5 (Boards) ‚úÖ
> 
> **–°–µ—Ä–≤–µ—Ä:** http://localhost:3001/api
> 
> **Swagger:** http://localhost:3001/api/docs

---

## üéØ –¶–µ–ª—å —ç—Ç–∞–ø–∞

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏: –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π, –ø–æ–∏—Å–∫, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–µ–≥–∞–º, –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ —É–¥–∞–ª–µ–Ω–∏–µ.

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ –≠—Ç–∞–ø–µ 7 (Upload). –î–∞–Ω–Ω—ã–π —ç—Ç–∞–ø —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ CRUD –æ–ø–µ—Ä–∞—Ü–∏—è—Ö —Å —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏.

---

## üìö –ì–ª–æ—Å—Å–∞—Ä–∏–π (–¥–ª—è frontend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)

### üñºÔ∏è Image (–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)

**Image** ‚Äî –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏. –ö–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ –¥–æ—Å–∫–µ.

### üè∑Ô∏è Tags (–¢–µ–≥–∏)

**Tags** ‚Äî –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.

### üìê Dimensions (–†–∞–∑–º–µ—Ä—ã)

**Dimensions** ‚Äî —à–∏—Ä–∏–Ω–∞ (width) –∏ –≤—ã—Å–æ—Ç–∞ (height) –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ø–∏–∫—Å–µ–ª—è—Ö. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ masonry grid.

### üíæ isFavorite

**isFavorite** ‚Äî —Ñ–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ —Ç–µ–∫—É—â–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

### üìå isSaved

**isSaved** ‚Äî —Ñ–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –∫–∞–∫—É—é-–ª–∏–±–æ –¥–æ—Å–∫—É —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
backend/src/modules/images/
‚îú‚îÄ‚îÄ images.module.ts              # –ú–æ–¥—É–ª—å
‚îú‚îÄ‚îÄ images.controller.ts          # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
‚îú‚îÄ‚îÄ images.service.ts             # –°–µ—Ä–≤–∏—Å
‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts                  # –≠–∫—Å–ø–æ—Ä—Ç entities
‚îÇ   ‚îî‚îÄ‚îÄ image.entity.ts           # Entity –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—É–∂–µ –µ—Å—Ç—å)
‚îî‚îÄ‚îÄ dto/
    ‚îú‚îÄ‚îÄ index.ts                  # –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö DTO
    ‚îú‚îÄ‚îÄ update-image.dto.ts       # DTO –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    ‚îú‚îÄ‚îÄ image-response.dto.ts     # DTO –æ—Ç–≤–µ—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    ‚îî‚îÄ‚îÄ image-query.dto.ts        # DTO query –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```

---

## üìù API Endpoints

### GET /api/images

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π, –ø–æ–∏—Å–∫–æ–º –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π.

**–î–æ—Å—Ç—É–ø:** –ü—É–±–ª–∏—á–Ω—ã–π

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | Default | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|---------|----------|
| page | number | 1 | –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã |
| pageSize | number | 12 | –†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (max: 50) |
| boardId | string | - | –§–∏–ª—å—Ç—Ä –ø–æ –¥–æ—Å–∫–µ |
| userId | string | - | –§–∏–ª—å—Ç—Ä –ø–æ –≤–ª–∞–¥–µ–ª—å—Ü—É |
| query | string | - | –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é/–æ–ø–∏—Å–∞–Ω–∏—é |
| tags | string | - | –§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–≥–∞–º (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) |
| sortBy | string | newest | –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: newest, oldest, title_asc, title_desc |

**Response (200):**
```json
{
  "items": [
    {
      "id": "uuid",
      "url": "/uploads/images/image.jpg",
      "title": "Beautiful Sunset",
      "description": "Sunset over the ocean",
      "tags": ["nature", "sunset", "ocean"],
      "width": 1920,
      "height": 1080,
      "size": 245760,
      "mimeType": "image/jpeg",
      "isFavorite": false,
      "isSaved": true,
      "favoritesCount": 42,
      "user": {
        "id": "uuid",
        "username": "johndoe",
        "avatar": "/uploads/avatars/avatar.jpg"
      },
      "board": {
        "id": "uuid",
        "title": "Nature Collection"
      },
      "createdAt": "2024-01-01T00:00:00.000Z"
    }
  ],
  "page": 1,
  "pageSize": 12,
  "totalItems": 150,
  "totalPages": 13,
  "hasMore": true
}
```

---

### GET /api/images/:id

–ü–æ–ª—É—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ ID.

**–î–æ—Å—Ç—É–ø:** –ü—É–±–ª–∏—á–Ω—ã–π

**Response (200):**
```json
{
  "id": "uuid",
  "url": "/uploads/images/image.jpg",
  "title": "Beautiful Sunset",
  "description": "Sunset over the ocean with vibrant colors",
  "tags": ["nature", "sunset", "ocean"],
  "width": 1920,
  "height": 1080,
  "size": 245760,
  "mimeType": "image/jpeg",
  "isFavorite": true,
  "isSaved": false,
  "favoritesCount": 42,
  "user": {
    "id": "uuid",
    "username": "johndoe",
    "avatar": "/uploads/avatars/avatar.jpg"
  },
  "board": {
    "id": "uuid",
    "title": "Nature Collection"
  },
  "createdAt": "2024-01-01T00:00:00.000Z"
}
```

**Errors:**
- `404` ‚Äî –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

---

### PUT /api/images/:id

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

**Headers:** `Cookie: access_token=...`

**Request:**
```json
{
  "title": "Updated Title",
  "description": "Updated description",
  "tags": ["nature", "landscape", "mountains"]
}
```

**Response (200):**
```json
{
  "id": "uuid",
  "url": "/uploads/images/image.jpg",
  "title": "Updated Title",
  "description": "Updated description",
  "tags": ["nature", "landscape", "mountains"],
  "width": 1920,
  "height": 1080,
  "size": 245760,
  "mimeType": "image/jpeg",
  "isFavorite": false,
  "isSaved": true,
  "favoritesCount": 42,
  "user": {
    "id": "uuid",
    "username": "johndoe",
    "avatar": "/uploads/avatars/avatar.jpg"
  },
  "board": {
    "id": "uuid",
    "title": "Nature Collection"
  },
  "createdAt": "2024-01-01T00:00:00.000Z"
}
```

**Errors:**
- `400` ‚Äî –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `401` ‚Äî –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `403` ‚Äî –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `404` ‚Äî –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

---

### DELETE /api/images/:id

–£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

**Headers:** `Cookie: access_token=...`

**Response (200):**
```json
{
  "message": "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ"
}
```

**Errors:**
- `401` ‚Äî –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `403` ‚Äî –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ
- `404` ‚Äî –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

> **–í–∞–∂–Ω–æ:** –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–∫–∂–µ —É–¥–∞–ª—è–µ—Ç—Å—è —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞ –∏ –≤—Å–µ —Å–≤—è–∑–∏ —Å –¥–æ—Å–∫–∞–º–∏ (board_images).

---

## üíª –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### DTOs

#### image-query.dto.ts

```typescript
import { IsOptional, IsString, IsInt, Min, Max, IsEnum, IsUUID } from 'class-validator';
import { Type } from 'class-transformer';
import { ApiProperty } from '@nestjs/swagger';

export enum ImageSortBy {
  NEWEST = 'newest',
  OLDEST = 'oldest',
  TITLE_ASC = 'title_asc',
  TITLE_DESC = 'title_desc',
}

/**
 * DTO –¥–ª—è query –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–ø–∏—Å–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
 */
export class ImageQueryDto {
  @ApiProperty({ example: 1, required: false, default: 1 })
  @IsOptional()
  @Type(() => Number)
  @IsInt()
  @Min(1)
  page?: number = 1;

  @ApiProperty({ example: 12, required: false, default: 12, maximum: 50 })
  @IsOptional()
  @Type(() => Number)
  @IsInt()
  @Min(1)
  @Max(50)
  pageSize?: number = 12;

  @ApiProperty({ example: 'uuid', required: false, description: '–§–∏–ª—å—Ç—Ä –ø–æ –¥–æ—Å–∫–µ' })
  @IsOptional()
  @IsUUID('4', { message: '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID –¥–æ—Å–∫–∏' })
  boardId?: string;

  @ApiProperty({ example: 'uuid', required: false, description: '–§–∏–ª—å—Ç—Ä –ø–æ –≤–ª–∞–¥–µ–ª—å—Ü—É' })
  @IsOptional()
  @IsUUID('4', { message: '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' })
  userId?: string;

  @ApiProperty({ example: 'sunset', required: false, description: '–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é/–æ–ø–∏—Å–∞–Ω–∏—é' })
  @IsOptional()
  @IsString()
  query?: string;

  @ApiProperty({ example: 'nature,sunset', required: false, description: '–§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–≥–∞–º (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)' })
  @IsOptional()
  @IsString()
  tags?: string;

  @ApiProperty({ 
    enum: ImageSortBy, 
    required: false, 
    default: ImageSortBy.NEWEST,
    description: '–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞' 
  })
  @IsOptional()
  @IsEnum(ImageSortBy)
  sortBy?: ImageSortBy = ImageSortBy.NEWEST;
}
```

#### update-image.dto.ts

```typescript
import { IsString, IsOptional, IsArray, MaxLength } from 'class-validator';
import { ApiProperty } from '@nestjs/swagger';

/**
 * DTO –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
 */
export class UpdateImageDto {
  @ApiProperty({
    example: 'Beautiful Sunset',
    description: '–ù–∞–∑–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤)',
    required: false,
  })
  @IsOptional()
  @IsString()
  @MaxLength(200, { message: '–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∞–∫—Å–∏–º—É–º 200 —Å–∏–º–≤–æ–ª–æ–≤' })
  title?: string;

  @ApiProperty({
    example: 'Sunset over the ocean with vibrant colors',
    description: '–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è',
    required: false,
  })
  @IsOptional()
  @IsString()
  @MaxLength(2000, { message: '–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∞–∫—Å–∏–º—É–º 2000 —Å–∏–º–≤–æ–ª–æ–≤' })
  description?: string;

  @ApiProperty({
    example: ['nature', 'sunset', 'ocean'],
    description: '–¢–µ–≥–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è',
    required: false,
    type: [String],
  })
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  tags?: string[];
}
```

#### image-response.dto.ts

```typescript
import { ApiProperty } from '@nestjs/swagger';

/**
 * DTO –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–∫—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
 */
export class ImageUserDto {
  @ApiProperty({ example: 'uuid' })
  id: string;

  @ApiProperty({ example: 'johndoe' })
  username: string;

  @ApiProperty({ example: '/uploads/avatars/avatar.jpg', nullable: true })
  avatar: string | null;
}

/**
 * DTO –¥–æ—Å–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–∫—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
 */
export class ImageBoardDto {
  @ApiProperty({ example: 'uuid' })
  id: string;

  @ApiProperty({ example: 'Nature Collection' })
  title: string;
}

/**
 * DTO –æ—Ç–≤–µ—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
 */
export class ImageResponseDto {
  @ApiProperty({ example: 'uuid' })
  id: string;

  @ApiProperty({ example: '/uploads/images/image.jpg' })
  url: string;

  @ApiProperty({ example: 'Beautiful Sunset', nullable: true })
  title: string | null;

  @ApiProperty({ example: 'Sunset over the ocean', nullable: true })
  description: string | null;

  @ApiProperty({ example: ['nature', 'sunset'], nullable: true })
  tags: string[] | null;

  @ApiProperty({ example: 1920, nullable: true })
  width: number | null;

  @ApiProperty({ example: 1080, nullable: true })
  height: number | null;

  @ApiProperty({ example: 245760, nullable: true })
  size: number | null;

  @ApiProperty({ example: 'image/jpeg', nullable: true })
  mimeType: string | null;

  @ApiProperty({ example: false })
  isFavorite: boolean;

  @ApiProperty({ example: true })
  isSaved: boolean;

  @ApiProperty({ example: 42 })
  favoritesCount: number;

  @ApiProperty({ type: ImageUserDto })
  user: ImageUserDto;

  @ApiProperty({ type: ImageBoardDto, nullable: true })
  board: ImageBoardDto | null;

  @ApiProperty({ example: '2024-01-01T00:00:00.000Z' })
  createdAt: Date;
}

/**
 * DTO –ø–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
 */
export class PaginatedImagesResponseDto {
  @ApiProperty({ type: [ImageResponseDto] })
  items: ImageResponseDto[];

  @ApiProperty({ example: 1 })
  page: number;

  @ApiProperty({ example: 12 })
  pageSize: number;

  @ApiProperty({ example: 150 })
  totalItems: number;

  @ApiProperty({ example: 13 })
  totalPages: number;

  @ApiProperty({ example: true })
  hasMore: boolean;
}
```

#### dto/index.ts

```typescript
export * from './image-query.dto';
export * from './update-image.dto';
export * from './image-response.dto';
```

---

### images.service.ts

```typescript
import {
  Injectable,
  NotFoundException,
  ForbiddenException,
} from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository, SelectQueryBuilder } from 'typeorm';
import { Image } from './entities/image.entity';
import { Favorite } from '../favorites/entities/favorite.entity';
import { BoardImage } from '../boards/entities/board-image.entity';
import { UpdateImageDto, ImageQueryDto, ImageSortBy } from './dto';
import * as fs from 'fs';
import * as path from 'path';

/**
 * –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
 */
@Injectable()
export class ImagesService {
  constructor(
    @InjectRepository(Image)
    private imagesRepository: Repository<Image>,
    @InjectRepository(Favorite)
    private favoritesRepository: Repository<Favorite>,
    @InjectRepository(BoardImage)
    private boardImagesRepository: Repository<BoardImage>,
  ) {}

  // ==================== CRUD OPERATIONS ====================

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
   */
  async findAll(
    queryDto: ImageQueryDto,
    currentUserId?: string,
  ): Promise<{
    items: any[];
    page: number;
    pageSize: number;
    totalItems: number;
    totalPages: number;
    hasMore: boolean;
  }> {
    const { 
      page = 1, 
      pageSize = 12, 
      boardId, 
      userId, 
      query, 
      tags, 
      sortBy = ImageSortBy.NEWEST 
    } = queryDto;

    const queryBuilder = this.imagesRepository
      .createQueryBuilder('image')
      .leftJoinAndSelect('image.user', 'user')
      .leftJoinAndSelect('image.board', 'board');

    // –§–∏–ª—å—Ç—Ä –ø–æ –¥–æ—Å–∫–µ
    if (boardId) {
      queryBuilder.andWhere('image.boardId = :boardId', { boardId });
    }

    // –§–∏–ª—å—Ç—Ä –ø–æ –≤–ª–∞–¥–µ–ª—å—Ü—É
    if (userId) {
      queryBuilder.andWhere('image.userId = :userId', { userId });
    }

    // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é/–æ–ø–∏—Å–∞–Ω–∏—é
    if (query) {
      queryBuilder.andWhere(
        '(LOWER(image.title) LIKE LOWER(:query) OR LOWER(image.description) LIKE LOWER(:query))',
        { query: `%${query}%` },
      );
    }

    // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–≥–∞–º
    if (tags) {
      const tagsArray = tags.split(',').map(t => t.trim().toLowerCase());
      queryBuilder.andWhere('image.tags && :tags', { tags: tagsArray });
    }

    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
    this.applySorting(queryBuilder, sortBy);

    // –ü–∞–≥–∏–Ω–∞—Ü–∏—è
    const totalItems = await queryBuilder.getCount();
    const totalPages = Math.ceil(totalItems / pageSize);

    const images = await queryBuilder
      .skip((page - 1) * pageSize)
      .take(pageSize)
      .getMany();

    // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
    const items = await Promise.all(
      images.map(async (image) => this.formatImage(image, currentUserId)),
    );

    return {
      items,
      page,
      pageSize,
      totalItems,
      totalPages,
      hasMore: page < totalPages,
    };
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ ID
   */
  async findOne(id: string, currentUserId?: string): Promise<any> {
    const image = await this.imagesRepository.findOne({
      where: { id },
      relations: ['user', 'board'],
    });

    if (!image) {
      throw new NotFoundException('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
    }

    return this.formatImage(image, currentUserId);
  }

  /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   */
  async update(id: string, userId: string, updateDto: UpdateImageDto): Promise<any> {
    const image = await this.findOneForOwner(id, userId);

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—è
    if (updateDto.title !== undefined) {
      image.title = updateDto.title;
    }
    if (updateDto.description !== undefined) {
      image.description = updateDto.description;
    }
    if (updateDto.tags !== undefined) {
      image.tags = updateDto.tags.map(t => t.toLowerCase().trim());
    }

    const saved = await this.imagesRepository.save(image);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–≤—è–∑–∏ –¥–ª—è –æ—Ç–≤–µ—Ç–∞
    const updated = await this.imagesRepository.findOne({
      where: { id: saved.id },
      relations: ['user', 'board'],
    });

    return this.formatImage(updated!, userId);
  }

  /**
   * –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   */
  async remove(id: string, userId: string): Promise<void> {
    const image = await this.findOneForOwner(id, userId);

    // –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞
    await this.deleteImageFile(image.url);

    // –£–¥–∞–ª—è–µ–º –∑–∞–ø–∏—Å—å –∏–∑ –ë–î (—Å–≤—è–∑–∏ —É–¥–∞–ª—è—Ç—Å—è –∫–∞—Å–∫–∞–¥–Ω–æ)
    await this.imagesRepository.remove(image);
  }

  // ==================== USER IMAGES (–¥–ª—è profile) ====================

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è /api/profile/images)
   */
  async getUserImages(
    userId: string,
    page: number = 1,
    pageSize: number = 12,
  ): Promise<{
    items: any[];
    page: number;
    pageSize: number;
    totalItems: number;
    totalPages: number;
    hasMore: boolean;
  }> {
    const queryBuilder = this.imagesRepository
      .createQueryBuilder('image')
      .leftJoinAndSelect('image.user', 'user')
      .leftJoinAndSelect('image.board', 'board')
      .where('image.userId = :userId', { userId })
      .orderBy('image.createdAt', 'DESC');

    const totalItems = await queryBuilder.getCount();
    const totalPages = Math.ceil(totalItems / pageSize);

    const images = await queryBuilder
      .skip((page - 1) * pageSize)
      .take(pageSize)
      .getMany();

    const items = await Promise.all(
      images.map(async (image) => this.formatImage(image, userId)),
    );

    return {
      items,
      page,
      pageSize,
      totalItems,
      totalPages,
      hasMore: page < totalPages,
    };
  }

  // ==================== PRIVATE METHODS ====================

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤–ª–∞–¥–µ–ª—å—Ü–∞
   */
  private async findOneForOwner(id: string, userId: string): Promise<Image> {
    const image = await this.imagesRepository.findOne({
      where: { id },
    });

    if (!image) {
      throw new NotFoundException('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
    }

    if (image.userId !== userId) {
      throw new ForbiddenException('–ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
    }

    return image;
  }

  /**
   * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –æ—Ç–≤–µ—Ç–∞
   */
  private async formatImage(image: Image, currentUserId?: string): Promise<any> {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–∏ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
    let isFavorite = false;
    if (currentUserId) {
      const favorite = await this.favoritesRepository.findOne({
        where: { userId: currentUserId, imageId: image.id },
      });
      isFavorite = !!favorite;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–∏ –Ω–∞ –¥–æ—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    let isSaved = false;
    if (currentUserId) {
      const saved = await this.boardImagesRepository
        .createQueryBuilder('bi')
        .innerJoin('bi.board', 'board')
        .where('bi.imageId = :imageId', { imageId: image.id })
        .andWhere('board.userId = :userId', { userId: currentUserId })
        .getOne();
      isSaved = !!saved;
    }

    // –ü–æ–¥—Å—á—ë—Ç –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
    const favoritesCount = await this.favoritesRepository.count({
      where: { imageId: image.id },
    });

    return {
      id: image.id,
      url: image.url,
      title: image.title,
      description: image.description,
      tags: image.tags,
      width: image.width,
      height: image.height,
      size: image.size,
      mimeType: image.mimeType,
      isFavorite,
      isSaved,
      favoritesCount,
      user: image.user
        ? {
            id: image.user.id,
            username: image.user.username,
            avatar: image.user.avatar,
          }
        : null,
      board: image.board
        ? {
            id: image.board.id,
            title: image.board.title,
          }
        : null,
      createdAt: image.createdAt,
    };
  }

  /**
   * –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –¥–∏—Å–∫–∞
   */
  private async deleteImageFile(url: string): Promise<void> {
    try {
      // url –∏–º–µ–µ—Ç —Ñ–æ—Ä–º–∞—Ç /uploads/images/filename.jpg
      const filePath = path.join(process.cwd(), url);
      if (fs.existsSync(filePath)) {
        fs.unlinkSync(filePath);
      }
    } catch (error) {
      // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É, –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –ë–î
      console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞:', error);
    }
  }

  /**
   * –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
   */
  private applySorting(
    queryBuilder: SelectQueryBuilder<Image>,
    sortBy: ImageSortBy,
  ): void {
    switch (sortBy) {
      case ImageSortBy.OLDEST:
        queryBuilder.orderBy('image.createdAt', 'ASC');
        break;
      case ImageSortBy.TITLE_ASC:
        queryBuilder.orderBy('image.title', 'ASC');
        break;
      case ImageSortBy.TITLE_DESC:
        queryBuilder.orderBy('image.title', 'DESC');
        break;
      case ImageSortBy.NEWEST:
      default:
        queryBuilder.orderBy('image.createdAt', 'DESC');
        break;
    }
  }
}
```

---

### images.controller.ts

```typescript
import {
  Controller,
  Get,
  Put,
  Delete,
  Body,
  Param,
  Query,
  UseGuards,
  HttpCode,
  HttpStatus,
  ParseUUIDPipe,
} from '@nestjs/common';
import {
  ApiTags,
  ApiOperation,
  ApiResponse,
  ApiBearerAuth,
  ApiParam,
  ApiQuery,
} from '@nestjs/swagger';
import { ImagesService } from './images.service';
import {
  UpdateImageDto,
  ImageQueryDto,
  ImageResponseDto,
  PaginatedImagesResponseDto,
} from './dto';
import { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';
import { CurrentUser } from '../auth/decorators/current-user.decorator';
import { Public } from '../auth/decorators/public.decorator';

/**
 * –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
 * 
 * API Endpoints:
 * GET    /api/images      ‚Äî —Å–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
 * GET    /api/images/:id  ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
 * PUT    /api/images/:id  ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
 * DELETE /api/images/:id  ‚Äî —É–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
 */
@ApiTags('Images')
@Controller('images')
export class ImagesController {
  constructor(private imagesService: ImagesService) {}

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   */
  @Get()
  @Public()
  @ApiOperation({ summary: '–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π' })
  @ApiQuery({ name: 'page', required: false, type: Number })
  @ApiQuery({ name: 'pageSize', required: false, type: Number })
  @ApiQuery({ name: 'boardId', required: false, type: String })
  @ApiQuery({ name: 'userId', required: false, type: String })
  @ApiQuery({ name: 'query', required: false, type: String })
  @ApiQuery({ name: 'tags', required: false, type: String })
  @ApiQuery({ name: 'sortBy', required: false, enum: ['newest', 'oldest', 'title_asc', 'title_desc'] })
  @ApiResponse({ status: 200, description: '–°–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π', type: PaginatedImagesResponseDto })
  async findAll(
    @Query() queryDto: ImageQueryDto,
    @CurrentUser('userId') userId?: string,
  ) {
    return this.imagesService.findAll(queryDto, userId);
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   */
  @Get(':id')
  @Public()
  @ApiOperation({ summary: '–ü–æ–ª—É—á–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ ID' })
  @ApiParam({ name: 'id', description: 'ID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è' })
  @ApiResponse({ status: 200, description: '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ', type: ImageResponseDto })
  @ApiResponse({ status: 404, description: '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' })
  async findOne(
    @Param('id', ParseUUIDPipe) id: string,
    @CurrentUser('userId') userId?: string,
  ) {
    return this.imagesService.findOne(id, userId);
  }

  /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   */
  @Put(':id')
  @UseGuards(JwtAuthGuard)
  @ApiBearerAuth()
  @ApiOperation({ summary: '–û–±–Ω–æ–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' })
  @ApiParam({ name: 'id', description: 'ID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è' })
  @ApiResponse({ status: 200, description: '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', type: ImageResponseDto })
  @ApiResponse({ status: 401, description: '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' })
  @ApiResponse({ status: 403, description: '–ù–µ—Ç –ø—Ä–∞–≤' })
  @ApiResponse({ status: 404, description: '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' })
  async update(
    @Param('id', ParseUUIDPipe) id: string,
    @CurrentUser('userId') userId: string,
    @Body() updateDto: UpdateImageDto,
  ) {
    return this.imagesService.update(id, userId, updateDto);
  }

  /**
   * –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   */
  @Delete(':id')
  @UseGuards(JwtAuthGuard)
  @ApiBearerAuth()
  @HttpCode(HttpStatus.OK)
  @ApiOperation({ summary: '–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' })
  @ApiParam({ name: 'id', description: 'ID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è' })
  @ApiResponse({ status: 200, description: '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ' })
  @ApiResponse({ status: 401, description: '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' })
  @ApiResponse({ status: 403, description: '–ù–µ—Ç –ø—Ä–∞–≤' })
  @ApiResponse({ status: 404, description: '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' })
  async remove(
    @Param('id', ParseUUIDPipe) id: string,
    @CurrentUser('userId') userId: string,
  ) {
    await this.imagesService.remove(id, userId);
    return { message: '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ' };
  }
}
```

---

### images.module.ts

```typescript
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { Image } from './entities/image.entity';
import { Favorite } from '../favorites/entities/favorite.entity';
import { BoardImage } from '../boards/entities/board-image.entity';
import { ImagesService } from './images.service';
import { ImagesController } from './images.controller';

/**
 * –ú–æ–¥—É–ª—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
 */
@Module({
  imports: [
    TypeOrmModule.forFeature([Image, Favorite, BoardImage]),
  ],
  controllers: [ImagesController],
  providers: [ImagesService],
  exports: [ImagesService],
})
export class ImagesModule {}
```

---

### entities/index.ts

```typescript
export * from './image.entity';
```

---

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UsersController

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è ImagesService –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–Ω–æ–≤–∏—Ç—å `UsersController` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:

### users.controller.ts (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)

```typescript
// –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç
import { ImagesService } from '../images/images.service';

// –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
constructor(
  private usersService: UsersService,
  private boardsService: BoardsService,
  private imagesService: ImagesService, // –î–æ–±–∞–≤–∏—Ç—å
) {}

// –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ getImages
@Get('images')
@ApiOperation({ summary: '–ü–æ–ª—É—á–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' })
@ApiQuery({ name: 'page', required: false, type: Number })
@ApiQuery({ name: 'pageSize', required: false, type: Number })
@ApiResponse({ status: 200, description: '–°–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π' })
async getImages(
  @CurrentUser('userId') userId: string,
  @Query('page') page?: number,
  @Query('pageSize') pageSize?: number,
) {
  return this.imagesService.getUserImages(userId, page || 1, pageSize || 12);
}
```

### users.module.ts (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)

```typescript
import { Module, forwardRef } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { MulterModule } from '@nestjs/platform-express';
import { User } from './entities/user.entity';
import { UsersService } from './users.service';
import { UsersController } from './users.controller';
import { BoardsModule } from '../boards/boards.module';
import { ImagesModule } from '../images/images.module'; // –î–æ–±–∞–≤–∏—Ç—å

@Module({
  imports: [
    TypeOrmModule.forFeature([User]),
    MulterModule.register({
      dest: './uploads/avatars',
    }),
    forwardRef(() => BoardsModule),
    forwardRef(() => ImagesModule), // –î–æ–±–∞–≤–∏—Ç—å
  ],
  controllers: [UsersController],
  providers: [UsersService],
  exports: [UsersService],
})
export class UsersModule {}
```

---

## üîß –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–æ–¥—É–ª—è –≤ AppModule

### app.module.ts

```typescript
import { Module } from '@nestjs/common';
import { ConfigModule } from '@nestjs/config';
import { TypeOrmModule } from '@nestjs/typeorm';
// ... –¥—Ä—É–≥–∏–µ –∏–º–ø–æ—Ä—Ç—ã
import { ImagesModule } from './modules/images/images.module'; // –î–æ–±–∞–≤–∏—Ç—å

@Module({
  imports: [
    ConfigModule.forRoot({ /* ... */ }),
    TypeOrmModule.forRootAsync({ /* ... */ }),
    AuthModule,
    UsersModule,
    BoardsModule,
    ImagesModule, // –î–æ–±–∞–≤–∏—Ç—å
    // ... –¥—Ä—É–≥–∏–µ –º–æ–¥—É–ª–∏
  ],
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß–µ—Ä–µ–∑ Swagger UI

–û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3001/api/docs

### –ß–µ—Ä–µ–∑ curl

```bash
# ==================== IMAGES CRUD ====================

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
curl "http://localhost:3001/api/images?page=1&pageSize=12"

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
curl "http://localhost:3001/api/images?query=sunset&tags=nature,landscape&sortBy=newest"

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–æ—Å–∫–∏
curl "http://localhost:3001/api/images?boardId={board-uuid}"

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl "http://localhost:3001/api/images?userId={user-uuid}"

# –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
curl http://localhost:3001/api/images/{image-id}

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
curl -X PUT http://localhost:3001/api/images/{image-id} \
  -H "Content-Type: application/json" \
  -d '{"title":"New Title","description":"New description","tags":["nature","updated"]}' \
  -b cookies.txt

# –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
curl -X DELETE http://localhost:3001/api/images/{image-id} \
  -b cookies.txt

# ==================== PROFILE IMAGES ====================

# –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl "http://localhost:3001/api/profile/images?page=1&pageSize=12" \
  -b cookies.txt
```

---

## üîÑ –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      –ü–û–õ–£–ß–ï–ù–ò–ï –°–ü–ò–°–ö–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  Frontend                          Backend                              ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                         ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                              ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  GET /api/images?... ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫  –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è             ‚îÇ
‚îÇ  Cookie: access_token (optional)   ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ                                    –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤:                 ‚îÇ
‚îÇ                                    - boardId                            ‚îÇ
‚îÇ                                    - userId                             ‚îÇ
‚îÇ                                    - query (–ø–æ–∏—Å–∫)                      ‚îÇ
‚îÇ                                    - tags                               ‚îÇ
‚îÇ                                    ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ                                    –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞                           ‚îÇ
‚îÇ                                    ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ                                    –ü–∞–≥–∏–Ω–∞—Ü–∏—è                            ‚îÇ
‚îÇ                                    ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ                                    –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π:                    ‚îÇ
‚îÇ                                    - isFavorite                         ‚îÇ
‚îÇ                                    - isSaved                            ‚îÇ
‚îÇ                                    - favoritesCount                     ‚îÇ
‚îÇ                                    ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ  ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ { items, page, totalItems, ... }     ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        –£–î–ê–õ–ï–ù–ò–ï –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  Frontend                          Backend                              ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                         ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                              ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  DELETE /api/images/:id ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫  JwtAuthGuard                         ‚îÇ
‚îÇ  Cookie: access_token              ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ                                    –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞                   ‚îÇ
‚îÇ                                    ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ                                    –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å –¥–∏—Å–∫–∞               ‚îÇ
‚îÇ                                    ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ                                    –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –ë–î                       ‚îÇ
‚îÇ                                    (–∫–∞—Å–∫–∞–¥–Ω–æ: favorites, board_images)  ‚îÇ
‚îÇ                                    ‚îÇ                                    ‚îÇ
‚îÇ                                    ‚ñº                                    ‚îÇ
‚îÇ  ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ { message: "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ" }   ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

1. **–ü–æ–∏—Å–∫ –ø–æ query** ‚Äî –∏—â–µ—Ç –≤ title –∏ description (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π)
2. **–§–∏–ª—å—Ç—Ä –ø–æ tags** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL –æ–ø–µ—Ä–∞—Ç–æ—Ä `&&` –¥–ª—è –º–∞—Å—Å–∏–≤–æ–≤
3. **–¢–µ–≥–∏** ‚Äî —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ, –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —Ç–∞–∫–∂–µ –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è

1. **isFavorite** ‚Äî –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)
2. **isSaved** ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –ª—é–±—É—é –¥–æ—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **favoritesCount** ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–π –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ

### –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
- –£–¥–∞–ª—è–µ—Ç—Å—è —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞
- –£–¥–∞–ª—è–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã images
- –ö–∞—Å–∫–∞–¥–Ω–æ —É–¥–∞–ª—è—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ –∏–∑ favorites
- –ö–∞—Å–∫–∞–¥–Ω–æ —É–¥–∞–ª—è—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ –∏–∑ board_images

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

1. **–ü—Ä–æ—Å–º–æ—Ç—Ä** ‚Äî –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º (–ø—É–±–ª–∏—á–Ω—ã–π)
2. **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü
3. **–£–¥–∞–ª–µ–Ω–∏–µ** ‚Äî —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç

- [ ] DTO —Å–æ–∑–¥–∞–Ω—ã
- [ ] ImagesService —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] ImagesController —Å–æ–∑–¥–∞–Ω
- [ ] ImagesModule —Å–æ–∑–¥–∞–Ω
- [ ] –ú–æ–¥—É–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ AppModule
- [ ] UsersController –æ–±–Ω–æ–≤–ª—ë–Ω –¥–ª—è /profile/images
- [ ] Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ curl/Swagger

---

## üìã –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö —ç—Ç–∞–ø–æ–≤

| –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å | –°—Ç–∞—Ç—É—Å |
|------------|-------------|--------|
| –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π | UploadModule | –≠—Ç–∞–ø 7 |
| –ò–∑–±—Ä–∞–Ω–Ω–æ–µ | FavoritesModule | –≠—Ç–∞–ø 8 |
| –î–æ—Å–∫–∏ | BoardsModule | ‚úÖ –≠—Ç–∞–ø 5 |

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≠—Ç–∞–ø 7 (Upload) –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –≠—Ç–∞–ø 8 (Favorites) –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–±—Ä–∞–Ω–Ω—ã–º. –î–æ —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ seed –¥–∞–Ω–Ω—ã–µ.

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ endpoints

–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–æ–≥–æ —ç—Ç–∞–ø–∞ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:

| Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| GET /api/images | –°–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π |
| GET /api/images/:id | –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è |
| PUT /api/images/:id | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è |
| DELETE /api/images/:id | –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è |
| GET /api/profile/images | –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
