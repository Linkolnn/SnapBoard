# Ğ­Ñ‚Ğ°Ğ¿ 8: ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ (Favorites)

> **Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** Ğ’ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ
> 
> **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸:** Ğ­Ñ‚Ğ°Ğ¿ 6 (Images) âœ…, Ğ­Ñ‚Ğ°Ğ¿ 3 (Auth) âœ…
> 
> **Ğ¡ĞµÑ€Ğ²ĞµÑ€:** http://localhost:3001/api
> 
> **Swagger:** http://localhost:3001/api/docs

---

## ğŸ¯ Ğ¦ĞµĞ»ÑŒ ÑÑ‚Ğ°Ğ¿Ğ°

Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸ÑĞ¼Ğ¸: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ/ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾, Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸ĞµĞ¹, batch-Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ»Ñ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹.

---

## ğŸ“š Ğ“Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ğ¹ (Ğ´Ğ»Ñ frontend Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ²)

### â¤ï¸ Favorites (Ğ˜Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ)

**Favorites** â€” Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ», Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑÑÑ‰Ğ¸Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑŒ Ğ¿Ğ¾Ğ½Ñ€Ğ°Ğ²Ğ¸Ğ²ÑˆĞ¸ĞµÑÑ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ² Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº. Ğ¡Ğ²ÑĞ·ÑŒ "Ğ¼Ğ½Ğ¾Ğ³Ğ¸Ğµ-ĞºĞ¾-Ğ¼Ğ½Ğ¾Ğ³Ğ¸Ğ¼" Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸ Ğ¸ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸ÑĞ¼Ğ¸.

### ğŸ”„ Toggle (ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ)

**Toggle** â€” Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½, Ğ¿Ñ€Ğ¸ ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğ¼ Ğ¾Ğ´Ğ½Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ, ĞµÑĞ»Ğ¸ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¼, Ğ¸Ğ»Ğ¸ ÑƒĞ´Ğ°Ğ»ÑĞµÑ‚, ĞµÑĞ»Ğ¸ ÑƒĞ¶Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾. Ğ’ Ğ½Ğ°ÑˆĞµĞ¼ API Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ÑÑ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ endpoints Ğ´Ğ»Ñ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ.

### ğŸ“¦ Batch Check (ĞŸĞ°ĞºĞµÑ‚Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°)

**Batch Check** â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ»Ñ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ¾Ğ´Ğ½Ğ¸Ğ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ¼. ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¸ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹.

### ğŸ“Š Favorites Count

**Favorites Count** â€” ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹, Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ²ÑˆĞ¸Ñ… Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ. ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾Ğ¿ÑƒĞ»ÑÑ€Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ.

---

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

```
backend/src/modules/favorites/
â”œâ”€â”€ favorites.module.ts           # ĞœĞ¾Ğ´ÑƒĞ»ÑŒ
â”œâ”€â”€ favorites.controller.ts       # ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€
â”œâ”€â”€ favorites.service.ts          # Ğ¡ĞµÑ€Ğ²Ğ¸Ñ
â”œâ”€â”€ entities/
â”‚   â”œâ”€â”€ index.ts                  # Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ entities
â”‚   â””â”€â”€ favorite.entity.ts        # Entity (ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚)
â””â”€â”€ dto/
    â”œâ”€â”€ index.ts                  # Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ²ÑĞµÑ… DTO
    â”œâ”€â”€ favorite-check.dto.ts     # DTO Ğ´Ğ»Ñ batch Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸
    â””â”€â”€ favorite-response.dto.ts  # DTO Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°
```

---

## ğŸ“ API Endpoints

### GET /api/favorites

ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ.

**Headers:** `Cookie: access_token=...`

**Query Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ¢Ğ¸Ğ¿ | ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|----------|-----|--------------|----------|
| page | number | 1 | ĞĞ¾Ğ¼ĞµÑ€ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ |
| pageSize | number | 12 | ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ½Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ (max: 50) |

**Response (200):**
```json
{
  "items": [
    {
      "id": "uuid",
      "url": "/uploads/images/image.jpg",
      "title": "Beautiful Sunset",
      "description": "Sunset over the ocean",
      "tags": ["nature", "sunset"],
      "width": 1920,
      "height": 1080,
      "isFavorite": true,
      "favoritesCount": 42,
      "user": {
        "id": "uuid",
        "username": "johndoe",
        "avatar": "/uploads/avatars/avatar.jpg"
      },
      "addedAt": "2024-01-01T00:00:00.000Z",
      "createdAt": "2024-01-01T00:00:00.000Z"
    }
  ],
  "page": 1,
  "pageSize": 12,
  "totalItems": 25,
  "totalPages": 3,
  "hasMore": true
}
```

**Errors:**
- `401` â€” ĞĞµ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½

---

### POST /api/favorites/:imageId

Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ.

**Headers:** `Cookie: access_token=...`

**Path Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ¢Ğ¸Ğ¿ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|----------|-----|----------|
| imageId | UUID | ID Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ |

**Response (201):**
```json
{
  "message": "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ",
  "imageId": "uuid",
  "favoritesCount": 43
}
```

**Errors:**
- `400` â€” Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ ÑƒĞ¶Ğµ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¼
- `401` â€” ĞĞµ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½
- `404` â€” Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾

---

### DELETE /api/favorites/:imageId

Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾.

**Headers:** `Cookie: access_token=...`

**Path Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ¢Ğ¸Ğ¿ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|----------|-----|----------|
| imageId | UUID | ID Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ |

**Response (200):**
```json
{
  "message": "Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾",
  "imageId": "uuid",
  "favoritesCount": 42
}
```

**Errors:**
- `400` â€” Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¼
- `401` â€” ĞĞµ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½
- `404` â€” Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾

---

### GET /api/favorites/check

ĞŸĞ°ĞºĞµÑ‚Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ»Ñ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹.

**Headers:** `Cookie: access_token=...`

**Query Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ¢Ğ¸Ğ¿ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|----------|-----|----------|
| imageIds | string | ID Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ñ‡ĞµÑ€ĞµĞ· Ğ·Ğ°Ğ¿ÑÑ‚ÑƒÑ (max: 50) |

**Response (200):**
```json
{
  "results": {
    "uuid-1": true,
    "uuid-2": false,
    "uuid-3": true
  }
}
```

**Errors:**
- `400` â€” ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ñ‹ imageIds Ğ¸Ğ»Ğ¸ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚
- `401` â€” ĞĞµ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½

---

## ğŸ’» Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

### DTOs

#### dto/favorite-check.dto.ts

```typescript
import { IsString, IsNotEmpty } from 'class-validator';
import { ApiProperty } from '@nestjs/swagger';

/**
 * DTO Ğ´Ğ»Ñ batch Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
 */
export class FavoriteCheckDto {
  @ApiProperty({
    example: 'uuid-1,uuid-2,uuid-3',
    description: 'ID Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ñ‡ĞµÑ€ĞµĞ· Ğ·Ğ°Ğ¿ÑÑ‚ÑƒÑ (max: 50)',
  })
  @IsString()
  @IsNotEmpty({ message: 'Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ imageIds' })
  imageIds: string;
}
```

#### dto/favorite-response.dto.ts

```typescript
import { ApiProperty } from '@nestjs/swagger';

/**
 * DTO Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (ĞºÑ€Ğ°Ñ‚ĞºĞ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ)
 */
export class FavoriteUserDto {
  @ApiProperty({ example: 'uuid' })
  id: string;

  @ApiProperty({ example: 'johndoe' })
  username: string;

  @ApiProperty({ example: '/uploads/avatars/avatar.jpg', nullable: true })
  avatar: string | null;
}

/**
 * DTO Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¼
 */
export class FavoriteImageDto {
  @ApiProperty({ example: 'uuid' })
  id: string;

  @ApiProperty({ example: '/uploads/images/image.jpg' })
  url: string;

  @ApiProperty({ example: 'Beautiful Sunset', nullable: true })
  title: string | null;

  @ApiProperty({ example: 'Sunset over the ocean', nullable: true })
  description: string | null;

  @ApiProperty({ example: ['nature', 'sunset'], nullable: true })
  tags: string[] | null;

  @ApiProperty({ example: 1920 })
  width: number;

  @ApiProperty({ example: 1080 })
  height: number;

  @ApiProperty({ example: true })
  isFavorite: boolean;

  @ApiProperty({ example: 42 })
  favoritesCount: number;

  @ApiProperty({ type: FavoriteUserDto })
  user: FavoriteUserDto;

  @ApiProperty({ example: '2024-01-01T00:00:00.000Z' })
  addedAt: Date;

  @ApiProperty({ example: '2024-01-01T00:00:00.000Z' })
  createdAt: Date;
}

/**
 * DTO Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° ÑĞ¿Ğ¸ÑĞºĞ° Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
 */
export class FavoritesListResponseDto {
  @ApiProperty({ type: [FavoriteImageDto] })
  items: FavoriteImageDto[];

  @ApiProperty({ example: 1 })
  page: number;

  @ApiProperty({ example: 12 })
  pageSize: number;

  @ApiProperty({ example: 25 })
  totalItems: number;

  @ApiProperty({ example: 3 })
  totalPages: number;

  @ApiProperty({ example: true })
  hasMore: boolean;
}

/**
 * DTO Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ/ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ
 */
export class FavoriteActionResponseDto {
  @ApiProperty({ example: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ' })
  message: string;

  @ApiProperty({ example: 'uuid' })
  imageId: string;

  @ApiProperty({ example: 43 })
  favoritesCount: number;
}

/**
 * DTO Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° batch Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸
 */
export class FavoriteCheckResponseDto {
  @ApiProperty({
    example: { 'uuid-1': true, 'uuid-2': false },
    description: 'ĞĞ±ÑŠĞµĞºÑ‚ Ñ ID Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ¸ Ğ¸Ñ… ÑÑ‚Ğ°Ñ‚ÑƒÑĞ¾Ğ¼ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾',
  })
  results: Record<string, boolean>;
}
```

#### dto/index.ts

```typescript
export * from './favorite-check.dto';
export * from './favorite-response.dto';
```

---

### favorites.service.ts

```typescript
import {
  Injectable,
  NotFoundException,
  BadRequestException,
} from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository, In } from 'typeorm';
import { Favorite } from './entities/favorite.entity';
import { Image } from '../images/entities/image.entity';

/**
 * Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¼
 */
@Injectable()
export class FavoritesService {
  constructor(
    @InjectRepository(Favorite)
    private favoritesRepository: Repository<Favorite>,
    @InjectRepository(Image)
    private imagesRepository: Repository<Image>,
  ) {}

  // ==================== PUBLIC METHODS ====================

  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
   */
  async getFavorites(
    userId: string,
    page: number = 1,
    pageSize: number = 12,
  ): Promise<{
    items: any[];
    page: number;
    pageSize: number;
    totalItems: number;
    totalPages: number;
    hasMore: boolean;
  }> {
    // ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ pageSize
    pageSize = Math.min(pageSize, 50);

    const queryBuilder = this.favoritesRepository
      .createQueryBuilder('favorite')
      .leftJoinAndSelect('favorite.image', 'image')
      .leftJoinAndSelect('image.user', 'user')
      .where('favorite.userId = :userId', { userId })
      .orderBy('favorite.createdAt', 'DESC');

    const totalItems = await queryBuilder.getCount();
    const totalPages = Math.ceil(totalItems / pageSize);

    const favorites = await queryBuilder
      .skip((page - 1) * pageSize)
      .take(pageSize)
      .getMany();

    // Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¾Ñ‚Ğ²ĞµÑ‚
    const items = await Promise.all(
      favorites.map(async (fav) => this.formatFavoriteImage(fav, userId)),
    );

    return {
      items,
      page,
      pageSize,
      totalItems,
      totalPages,
      hasMore: page < totalPages,
    };
  }

  /**
   * Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ
   */
  async addToFavorites(
    userId: string,
    imageId: string,
  ): Promise<{ message: string; imageId: string; favoritesCount: number }> {
    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
    const image = await this.imagesRepository.findOne({
      where: { id: imageId },
    });

    if (!image) {
      throw new NotFoundException('Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾');
    }

    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ½Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ»Ğ¸ ÑƒĞ¶Ğµ
    const existing = await this.favoritesRepository.findOne({
      where: { userId, imageId },
    });

    if (existing) {
      throw new BadRequestException('Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ ÑƒĞ¶Ğµ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¼');
    }

    // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ
    const favorite = this.favoritesRepository.create({
      userId,
      imageId,
    });

    await this.favoritesRepository.save(favorite);

    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½Ğ½Ñ‹Ğ¹ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº
    const favoritesCount = await this.getFavoritesCount(imageId);

    return {
      message: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ',
      imageId,
      favoritesCount,
    };
  }

  /**
   * Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
   */
  async removeFromFavorites(
    userId: string,
    imageId: string,
  ): Promise<{ message: string; imageId: string; favoritesCount: number }> {
    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
    const image = await this.imagesRepository.findOne({
      where: { id: imageId },
    });

    if (!image) {
      throw new NotFoundException('Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾');
    }

    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¼
    const favorite = await this.favoritesRepository.findOne({
      where: { userId, imageId },
    });

    if (!favorite) {
      throw new BadRequestException('Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¼');
    }

    // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ
    await this.favoritesRepository.remove(favorite);

    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½Ğ½Ñ‹Ğ¹ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº
    const favoritesCount = await this.getFavoritesCount(imageId);

    return {
      message: 'Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾',
      imageId,
      favoritesCount,
    };
  }

  /**
   * Batch Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
   */
  async checkFavorites(
    userId: string,
    imageIds: string[],
  ): Promise<Record<string, boolean>> {
    // ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾
    if (imageIds.length > 50) {
      throw new BadRequestException('ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 50 Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ·Ğ° Ñ€Ğ°Ğ·');
    }

    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ²ÑĞµ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· ÑĞ¿Ğ¸ÑĞºĞ°
    const favorites = await this.favoritesRepository.find({
      where: {
        userId,
        imageId: In(imageIds),
      },
      select: ['imageId'],
    });

    // Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
    const favoriteIds = new Set(favorites.map((f) => f.imageId));
    const results: Record<string, boolean> = {};

    imageIds.forEach((id) => {
      results[id] = favoriteIds.has(id);
    });

    return results;
  }

  // ==================== HELPER METHODS ====================

  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ° Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
   */
  async getFavoritesCount(imageId: string): Promise<number> {
    return this.favoritesRepository.count({
      where: { imageId },
    });
  }

  /**
   * ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°, Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ»Ğ¸ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ
   */
  async isFavorite(userId: string, imageId: string): Promise<boolean> {
    const favorite = await this.favoritesRepository.findOne({
      where: { userId, imageId },
    });
    return !!favorite;
  }

  // ==================== PRIVATE METHODS ====================

  /**
   * Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
   */
  private async formatFavoriteImage(
    favorite: Favorite,
    currentUserId: string,
  ): Promise<any> {
    const image = favorite.image;
    const favoritesCount = await this.getFavoritesCount(image.id);

    return {
      id: image.id,
      url: image.url,
      title: image.title,
      description: image.description,
      tags: image.tags,
      width: image.width,
      height: image.height,
      isFavorite: true, // Ğ’ÑĞµĞ³Ğ´Ğ° true, Ñ‚.Ğº. ÑÑ‚Ğ¾ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
      favoritesCount,
      user: image.user
        ? {
            id: image.user.id,
            username: image.user.username,
            avatar: image.user.avatar,
          }
        : null,
      addedAt: favorite.createdAt,
      createdAt: image.createdAt,
    };
  }
}
```


---

### favorites.controller.ts

```typescript
import {
  Controller,
  Get,
  Post,
  Delete,
  Param,
  Query,
  UseGuards,
  HttpCode,
  HttpStatus,
  ParseUUIDPipe,
} from '@nestjs/common';
import {
  ApiTags,
  ApiOperation,
  ApiResponse,
  ApiBearerAuth,
  ApiParam,
  ApiQuery,
} from '@nestjs/swagger';
import { FavoritesService } from './favorites.service';
import {
  FavoritesListResponseDto,
  FavoriteActionResponseDto,
  FavoriteCheckResponseDto,
} from './dto';
import { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';
import { CurrentUser } from '../auth/decorators/current-user.decorator';

/**
 * ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
 * 
 * API Endpoints:
 * GET    /api/favorites           â€” ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
 * POST   /api/favorites/:imageId  â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ
 * DELETE /api/favorites/:imageId  â€” ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
 * GET    /api/favorites/check     â€” batch Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
 */
@ApiTags('Favorites')
@Controller('favorites')
@UseGuards(JwtAuthGuard)
@ApiBearerAuth()
export class FavoritesController {
  constructor(private favoritesService: FavoritesService) {}

  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
   */
  @Get()
  @ApiOperation({ summary: 'ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾' })
  @ApiQuery({ name: 'page', required: false, type: Number })
  @ApiQuery({ name: 'pageSize', required: false, type: Number })
  @ApiResponse({ status: 200, description: 'Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾', type: FavoritesListResponseDto })
  @ApiResponse({ status: 401, description: 'ĞĞµ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½' })
  async getFavorites(
    @CurrentUser('userId') userId: string,
    @Query('page') page?: string,
    @Query('pageSize') pageSize?: string,
  ) {
    return this.favoritesService.getFavorites(
      userId,
      page ? parseInt(page, 10) : 1,
      pageSize ? parseInt(pageSize, 10) : 12,
    );
  }

  /**
   * Batch Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
   * Ğ’ĞĞ–ĞĞ: Ğ­Ñ‚Ğ¾Ñ‚ endpoint Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ”Ğ /:imageId, Ğ¸Ğ½Ğ°Ñ‡Ğµ "check" Ğ±ÑƒĞ´ĞµÑ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ¿Ñ€ĞµÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ ĞºĞ°Ğº UUID
   */
  @Get('check')
  @ApiOperation({ summary: 'ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ»Ñ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹' })
  @ApiQuery({ name: 'imageIds', required: true, description: 'ID Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ñ‡ĞµÑ€ĞµĞ· Ğ·Ğ°Ğ¿ÑÑ‚ÑƒÑ' })
  @ApiResponse({ status: 200, description: 'Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑÑ‹ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾', type: FavoriteCheckResponseDto })
  @ApiResponse({ status: 400, description: 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ñ‹ imageIds Ğ¸Ğ»Ğ¸ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚' })
  @ApiResponse({ status: 401, description: 'ĞĞµ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½' })
  async checkFavorites(
    @CurrentUser('userId') userId: string,
    @Query('imageIds') imageIds: string,
  ) {
    if (!imageIds || !imageIds.trim()) {
      return { results: {} };
    }

    const ids = imageIds.split(',').map((id) => id.trim()).filter(Boolean);
    const results = await this.favoritesService.checkFavorites(userId, ids);

    return { results };
  }

  /**
   * Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ
   */
  @Post(':imageId')
  @HttpCode(HttpStatus.CREATED)
  @ApiOperation({ summary: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ' })
  @ApiParam({ name: 'imageId', description: 'ID Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ' })
  @ApiResponse({ status: 201, description: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ', type: FavoriteActionResponseDto })
  @ApiResponse({ status: 400, description: 'Ğ£Ğ¶Ğµ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¼' })
  @ApiResponse({ status: 401, description: 'ĞĞµ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½' })
  @ApiResponse({ status: 404, description: 'Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾' })
  async addToFavorites(
    @CurrentUser('userId') userId: string,
    @Param('imageId', ParseUUIDPipe) imageId: string,
  ) {
    return this.favoritesService.addToFavorites(userId, imageId);
  }

  /**
   * Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
   */
  @Delete(':imageId')
  @HttpCode(HttpStatus.OK)
  @ApiOperation({ summary: 'Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾' })
  @ApiParam({ name: 'imageId', description: 'ID Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ' })
  @ApiResponse({ status: 200, description: 'Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾', type: FavoriteActionResponseDto })
  @ApiResponse({ status: 400, description: 'ĞĞµ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¼' })
  @ApiResponse({ status: 401, description: 'ĞĞµ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½' })
  @ApiResponse({ status: 404, description: 'Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾' })
  async removeFromFavorites(
    @CurrentUser('userId') userId: string,
    @Param('imageId', ParseUUIDPipe) imageId: string,
  ) {
    return this.favoritesService.removeFromFavorites(userId, imageId);
  }
}
```

---

### favorites.module.ts

```typescript
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { Favorite } from './entities/favorite.entity';
import { Image } from '../images/entities/image.entity';
import { FavoritesService } from './favorites.service';
import { FavoritesController } from './favorites.controller';

/**
 * ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
 */
@Module({
  imports: [TypeOrmModule.forFeature([Favorite, Image])],
  controllers: [FavoritesController],
  providers: [FavoritesService],
  exports: [FavoritesService],
})
export class FavoritesModule {}
```

---

## ğŸ”§ Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ² AppModule

### app.module.ts

```typescript
import { Module } from '@nestjs/common';
// ... Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹
import { FavoritesModule } from './modules/favorites/favorites.module'; // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ

@Module({
  imports: [
    // ... Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
    AuthModule,
    UsersModule,
    BoardsModule,
    ImagesModule,
    UploadModule,
    FavoritesModule, // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ
  ],
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}
```

---

## ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Ğ§ĞµÑ€ĞµĞ· Swagger UI

ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ http://localhost:3001/api/docs

### Ğ§ĞµÑ€ĞµĞ· curl

```bash
# ==================== ĞŸĞĞ›Ğ£Ğ§Ğ•ĞĞ˜Ğ• Ğ¡ĞŸĞ˜Ğ¡ĞšĞ Ğ˜Ğ—Ğ‘Ğ ĞĞĞĞĞ“Ğ ====================

# ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ (Ğ¿ĞµÑ€Ğ²Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°)
curl -X GET "http://localhost:3001/api/favorites" \
  -b cookies.txt

# ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ Ñ Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸ĞµĞ¹
curl -X GET "http://localhost:3001/api/favorites?page=2&pageSize=20" \
  -b cookies.txt

# ==================== Ğ”ĞĞ‘ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• Ğ’ Ğ˜Ğ—Ğ‘Ğ ĞĞĞĞĞ• ====================

# Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ
curl -X POST "http://localhost:3001/api/favorites/{image-uuid}" \
  -b cookies.txt

# ==================== Ğ£Ğ”ĞĞ›Ğ•ĞĞ˜Ğ• Ğ˜Ğ— Ğ˜Ğ—Ğ‘Ğ ĞĞĞĞĞ“Ğ ====================

# Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
curl -X DELETE "http://localhost:3001/api/favorites/{image-uuid}" \
  -b cookies.txt

# ==================== BATCH ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ¡Ğ¢ĞĞ¢Ğ£Ğ¡Ğ ====================

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ´Ğ»Ñ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹
curl -X GET "http://localhost:3001/api/favorites/check?imageIds=uuid-1,uuid-2,uuid-3" \
  -b cookies.txt
```

### Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ JavaScript (Frontend)

```javascript
// ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
const getFavorites = async (page = 1, pageSize = 12) => {
  const response = await fetch(`/api/favorites?page=${page}&pageSize=${pageSize}`, {
    credentials: 'include',
  });
  return response.json();
};

// Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ
const addToFavorites = async (imageId) => {
  const response = await fetch(`/api/favorites/${imageId}`, {
    method: 'POST',
    credentials: 'include',
  });
  return response.json();
};

// Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
const removeFromFavorites = async (imageId) => {
  const response = await fetch(`/api/favorites/${imageId}`, {
    method: 'DELETE',
    credentials: 'include',
  });
  return response.json();
};

// Batch Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
const checkFavorites = async (imageIds) => {
  const ids = imageIds.join(',');
  const response = await fetch(`/api/favorites/check?imageIds=${ids}`, {
    credentials: 'include',
  });
  return response.json();
};

// ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ batch Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹
const loadImagesWithFavoriteStatus = async () => {
  // 1. Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
  const { items: images } = await fetch('/api/images').then(r => r.json());
  
  // 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ»Ñ Ğ²ÑĞµÑ…
  const imageIds = images.map(img => img.id);
  const { results } = await checkFavorites(imageIds);
  
  // 3. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ² Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸ÑÑ…
  return images.map(img => ({
    ...img,
    isFavorite: results[img.id] || false,
  }));
};
```


---

## ğŸ”„ Ğ¡Ñ…ĞµĞ¼Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ğ”ĞĞ‘ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• Ğ’ Ğ˜Ğ—Ğ‘Ğ ĞĞĞĞĞ•                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Frontend                          Backend                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚                                                                         â”‚
â”‚  POST /api/favorites/:imageId â”€â”€â–º  JwtAuthGuard                         â”‚
â”‚  Cookie: access_token              â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚                                    FavoritesService.addToFavorites()    â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚                                    ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ   â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚                                    ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: ÑƒĞ¶Ğµ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¼?           â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â”œâ”€â”€ Ğ”Ğ° â”€â”€â–º 400 Bad Request           â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼ ĞĞµÑ‚                                â”‚
â”‚                                    Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ² favorites          â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚                                    ĞŸĞ¾Ğ´ÑÑ‡Ñ‘Ñ‚ favoritesCount               â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ { message, imageId, favoritesCount } â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ğ£Ğ”ĞĞ›Ğ•ĞĞ˜Ğ• Ğ˜Ğ— Ğ˜Ğ—Ğ‘Ğ ĞĞĞĞĞ“Ğ                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Frontend                          Backend                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚                                                                         â”‚
â”‚  DELETE /api/favorites/:imageId â”€â–º JwtAuthGuard                         â”‚
â”‚  Cookie: access_token              â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚                                    FavoritesService.removeFromFavorites â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚                                    ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ   â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚                                    ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: ĞµÑÑ‚ÑŒ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¼?          â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â”œâ”€â”€ ĞĞµÑ‚ â”€â”€â–º 400 Bad Request          â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼ Ğ”Ğ°                                 â”‚
â”‚                                    Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ¸Ğ· favorites         â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚                                    ĞŸĞ¾Ğ´ÑÑ‡Ñ‘Ñ‚ favoritesCount               â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ { message, imageId, favoritesCount } â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BATCH ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ¡Ğ¢ĞĞ¢Ğ£Ğ¡Ğ                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Frontend                          Backend                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚                                                                         â”‚
â”‚  GET /api/favorites/check â”€â”€â”€â”€â”€â”€â–º  JwtAuthGuard                         â”‚
â”‚  ?imageIds=id1,id2,id3             â”‚                                    â”‚
â”‚  Cookie: access_token              â–¼                                    â”‚
â”‚                                    FavoritesService.checkFavorites()    â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚                                    ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ imageIds (split by comma)    â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚                                    ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ° (max 50)             â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚                                    SELECT * FROM favorites              â”‚
â”‚                                    WHERE userId = :userId               â”‚
â”‚                                    AND imageId IN (:imageIds)           â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚                                    Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°              â”‚
â”‚                                    { id1: true, id2: false, ... }       â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ { results: { ... } }                 â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”— Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ ImagesService

ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Favorites ÑƒĞ¶Ğµ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ñ ImagesService. ĞŸÑ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ğ¿Ğ¾Ğ»Ñ:

- `isFavorite` â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ»Ğ¸ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼
- `favoritesCount` â€” Ğ¾Ğ±Ñ‰ĞµĞµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ

```typescript
// images.service.ts (ÑƒĞ¶Ğµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾)
private async formatImage(image: Image, currentUserId?: string): Promise<any> {
  // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ»Ğ¸ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ
  let isFavorite = false;
  if (currentUserId) {
    const favorite = await this.favoritesRepository.findOne({
      where: { userId: currentUserId, imageId: image.id },
    });
    isFavorite = !!favorite;
  }

  // ĞŸĞ¾Ğ´ÑÑ‡Ñ‘Ñ‚ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
  const favoritesCount = await this.favoritesRepository.count({
    where: { imageId: image.id },
  });

  return {
    // ... Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ğ¿Ğ¾Ğ»Ñ
    isFavorite,
    favoritesCount,
  };
}
```

---

## âš ï¸ Ğ’Ğ°Ğ¶Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ñ

### ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº endpoints Ğ² ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€Ğµ

```typescript
// Ğ’ĞĞ–ĞĞ: /check Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ”Ğ /:imageId
@Get('check')        // GET /api/favorites/check
async checkFavorites() { ... }

@Post(':imageId')    // POST /api/favorites/:imageId
async addToFavorites() { ... }
```

Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº, "check" Ğ±ÑƒĞ´ĞµÑ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ¿Ñ€ĞµÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ ĞºĞ°Ğº UUID Ğ¸ Ğ²Ñ‹Ğ·Ğ¾Ğ²ĞµÑ‚ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸.

### ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²

1. **Batch Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°** â€” Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ `GET /api/favorites/check` Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²Ğ° Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
2. **Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ 50** â€” Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 50 Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ·Ğ° Ğ¾Ğ´Ğ¸Ğ½ batch Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
3. **ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** â€” Ğ½Ğ° frontend Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾

### ĞšĞ°ÑĞºĞ°Ğ´Ğ½Ğ¾Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ

ĞŸÑ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ² favorites ÑƒĞ´Ğ°Ğ»ÑÑÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ñ `onDelete: 'CASCADE'` Ğ² entity.

### Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

ĞŸĞ°Ñ€Ğ° `(userId, imageId)` ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ° â€” Ğ½ĞµĞ»ÑŒĞ·Ñ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ´Ğ½Ğ¾ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ´Ğ²Ğ°Ğ¶Ğ´Ñ‹.

---

## âœ… Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚

- [ ] DTOs ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹
- [ ] FavoritesService Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½
- [ ] FavoritesController ÑĞ¾Ğ·Ğ´Ğ°Ğ½
- [ ] FavoritesModule ÑĞ¾Ğ·Ğ´Ğ°Ğ½
- [ ] ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ² AppModule
- [ ] Swagger Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
- [ ] Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· curl/Swagger
- [ ] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ ImagesService Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚

---

## ğŸ“‹ Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… ÑÑ‚Ğ°Ğ¿Ğ¾Ğ²

| Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ» | Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|------------|-------------|--------|
| Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ | ImagesModule | âœ… Ğ­Ñ‚Ğ°Ğ¿ 6 |
| ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ | AuthModule | âœ… Ğ­Ñ‚Ğ°Ğ¿ 3 |
| Entity Favorite | Ğ­Ñ‚Ğ°Ğ¿ 2 (Database) | âœ… Ğ­Ñ‚Ğ°Ğ¿ 2 |

---

## ğŸ”— Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ endpoints

ĞŸĞ¾ÑĞ»Ğµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ÑÑ‚Ğ¾Ğ³Ğ¾ ÑÑ‚Ğ°Ğ¿Ğ° Ğ±ÑƒĞ´ÑƒÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ:

| Endpoint | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|----------|----------|
| GET /api/favorites | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ |
| POST /api/favorites/:imageId | Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ |
| DELETE /api/favorites/:imageId | Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ |
| GET /api/favorites/check | Batch Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° |

---

## ğŸ¯ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ° Frontend

### Composable Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¼

```typescript
// frontend/composables/useFavorites.ts
export const useFavorites = () => {
  const favorites = ref<Image[]>([])
  const isLoading = ref(false)
  const favoriteStatus = ref<Record<string, boolean>>({})

  // Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ÑĞ¿Ğ¸ÑĞºĞ° Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
  const loadFavorites = async (page = 1, pageSize = 12) => {
    isLoading.value = true
    try {
      const { data } = await useFetch('/api/favorites', {
        query: { page, pageSize }
      })
      favorites.value = data.value?.items || []
      return data.value
    } finally {
      isLoading.value = false
    }
  }

  // Toggle Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾
  const toggleFavorite = async (imageId: string, currentStatus: boolean) => {
    try {
      if (currentStatus) {
        await $fetch(`/api/favorites/${imageId}`, { method: 'DELETE' })
      } else {
        await $fetch(`/api/favorites/${imageId}`, { method: 'POST' })
      }
      favoriteStatus.value[imageId] = !currentStatus
      return !currentStatus
    } catch (error) {
      console.error('Toggle favorite error:', error)
      throw error
    }
  }

  // Batch Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
  const checkFavoriteStatus = async (imageIds: string[]) => {
    if (!imageIds.length) return {}
    
    const { data } = await useFetch('/api/favorites/check', {
      query: { imageIds: imageIds.join(',') }
    })
    
    if (data.value?.results) {
      Object.assign(favoriteStatus.value, data.value.results)
    }
    
    return data.value?.results || {}
  }

  return {
    favorites,
    isLoading,
    favoriteStatus,
    loadFavorites,
    toggleFavorite,
    checkFavoriteStatus,
  }
}
```

### ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾

```vue
<!-- frontend/components/image/FavoriteButton.vue -->
<template>
  <button 
    @click="handleClick" 
    :class="['favorite-btn', { active: isFavorite }]"
    :disabled="isLoading"
  >
    <Icon :name="isFavorite ? 'heart-filled' : 'heart'" />
    <span v-if="showCount">{{ favoritesCount }}</span>
  </button>
</template>

<script setup lang="ts">
const props = defineProps<{
  imageId: string
  isFavorite: boolean
  favoritesCount: number
  showCount?: boolean
}>()

const emit = defineEmits<{
  toggle: [newStatus: boolean, newCount: number]
}>()

const { toggleFavorite } = useFavorites()
const isLoading = ref(false)

const handleClick = async () => {
  isLoading.value = true
  try {
    const newStatus = await toggleFavorite(props.imageId, props.isFavorite)
    const newCount = props.favoritesCount + (newStatus ? 1 : -1)
    emit('toggle', newStatus, newCount)
  } finally {
    isLoading.value = false
  }
}
</script>
```