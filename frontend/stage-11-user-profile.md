# Этап 11: Профиль пользователя

## 🎯 Цель этапа

Реализовать полноценную страницу профиля пользователя с возможностью редактирования данных, управления аватаром, просмотра статистики, контента пользователя и настроек безопасности.

---

## 📊 Текущее состояние

Существует базовая заглушка `pages/profile.vue` с:
- Отображением имени и email
- Простой формой редактирования (не работает)
- Кнопкой удаления аккаунта (не работает)

**Проблемы текущей реализации:**
- Не использует Base* компоненты из `common/`
- Нет загрузки/смены аватара
- Нет статистики пользователя
- Нет просмотра контента (доски, изображения)
- Нет смены пароля
- Форма не подключена к API

---

## 🏗️ Архитектура

### Структура файлов

```
frontend/
├── pages/
│   └── profile.vue                    # Главная страница профиля (рефакторинг)
│
├── components/
│   └── profile/
│       ├── Header.vue                 # Шапка профиля (аватар, имя, статистика)
│       ├── Avatar.vue                 # Компонент аватара с загрузкой
│       ├── EditForm.vue               # Форма редактирования профиля
│       ├── Stats.vue                  # Статистика пользователя
│       ├── ContentTabs.vue            # Вкладки контента (доски/изображения)
│       ├── PasswordModal.vue          # Модал смены пароля
│       └── DeleteAccountModal.vue     # Модал удаления аккаунта
│
├── composables/
│   └── useProfile.ts                  # Логика работы с профилем
│
├── server/api/
│   └── profile/
│       ├── index.put.ts               # Обновление профиля
│       ├── avatar.post.ts             # Загрузка аватара
│       ├── password.put.ts            # Смена пароля
│       ├── index.delete.ts            # Удаление аккаунта
│       ├── stats.get.ts               # Статистика пользователя
│       ├── boards.get.ts              # Доски пользователя
│       └── images.get.ts              # Изображения пользователя
│
└── types/
    └── user.ts                        # Расширение типов (уже существует)
```

---

## 📋 Чеклист реализации

### Фаза 1: Подготовка и типы

- [x] **1.1** Расширить типы в `types/user.ts`
  - Добавить `name`, `bio` в `User`
  - Создать `UserStats` interface
  - Создать `UpdateProfileDto`, `ChangePasswordDto`

- [x] **1.2** Создать `composables/useProfile.ts`
  - State: `isEditing`, `isSubmitting`, `stats`, `userBoards`, `userImages`
  - Actions: `updateProfile`, `uploadAvatar`, `changePassword`, `deleteAccount`

### Фаза 2: Компоненты профиля

- [x] **2.1** Создать `components/profile/Avatar.vue`
  - Props: `src`, `name`, `size`, `editable`
  - Отображение инициалов если нет аватара
  - Клик для выбора файла (если editable)
  - Валидация: тип файла, размер до 5MB
  - Превью перед загрузкой
  - Использовать `CommonBaseIconButton` для кнопки редактирования

- [x] **2.2** Создать `components/profile/Stats.vue`
  - Props: `stats: UserStats`
  - Отображение: количество досок, изображений, дата регистрации
  - Адаптивный дизайн

- [x] **2.3** Создать `components/profile/EditForm.vue`
  - Props: `user`, `isSubmitting`
  - Поля: имя, bio (опционально)
  - Валидация имени (минимум 2 символа)
  - Использовать `CommonBaseInput`, `CommonBaseTextarea`, `CommonBaseButton`
  - Emit: `submit`, `cancel`

- [x] **2.4** Создать `components/profile/Header.vue`
  - Объединяет Avatar и основную информацию
  - Props: `user`, `stats`, `isEditing`
  - Кнопка "Редактировать"

### Фаза 3: Контент пользователя

- [x] **3.1** Создать `components/profile/ContentTabs.vue`
  - Вкладки: "Мои доски", "Мои изображения"
  - Props: `activeTab`, `boards`, `images`, `isLoading`
  - Использовать `CommonBaseButton` для вкладок
  - Пустое состояние для каждой вкладки
  - Интеграция с `BoardCard` и `ImageMasonryGrid`

### Фаза 4: Модальные окна

- [x] **4.1** Создать `components/profile/PasswordModal.vue`
  - Поля: текущий пароль, новый пароль, подтверждение
  - Валидация: совпадение паролей, минимум 8 символов
  - Использовать `CommonBaseInput`, `CommonBaseButton`, `CommonBaseModal`

- [x] **4.2** Создать `components/profile/DeleteAccountModal.vue`
  - Предупреждение о последствиях
  - Поле ввода пароля для подтверждения
  - Использовать `CommonConfirmModal` как основу

### Фаза 5: API endpoints (mock)

- [x] **5.1** Создать `server/api/profile/index.put.ts`
  - Обновление имени и bio
  - Валидация на сервере

- [x] **5.2** Создать `server/api/profile/avatar.post.ts`
  - Приём FormData с файлом
  - Возврат URL аватара (mock)

- [x] **5.3** Создать `server/api/profile/password.put.ts`
  - Проверка текущего пароля
  - Обновление пароля

- [x] **5.4** Создать `server/api/profile/index.delete.ts`
  - Проверка пароля
  - Удаление аккаунта

- [x] **5.5** Создать `server/api/profile/stats.get.ts`
  - Возврат статистики пользователя

- [x] **5.6** Создать `server/api/profile/boards.get.ts`
  - Возврат досок пользователя

- [x] **5.7** Создать `server/api/profile/images.get.ts`
  - Возврат изображений пользователя

### Фаза 6: Интеграция страницы

- [x] **6.1** Рефакторинг `pages/profile.vue`
  - Использовать все созданные компоненты
  - Подключить `useProfile` composable
  - Адаптивный layout
  - Секция "Опасная зона" с кнопками смены пароля и удаления

### Фаза 7: Расширение auth store

- [x] **7.1** Добавить в `store/auth.ts`
  - `updateProfile(data)` - обновление профиля
  - `updateAvatar(url)` - обновление аватара в state

### Фаза 8: Тестирование и polish

- [x] **8.1** Проверить все сценарии
  - Редактирование профиля
  - Загрузка аватара
  - Смена пароля
  - Удаление аккаунта
  - Просмотр контента

- [ ] **8.2** Адаптивность
  - Mobile (320px - 767px)
  - Tablet (768px - 1023px)
  - Desktop (1024px+)

- [ ] **8.3** Обновить страницу избранного
  - Показывать реальные избранные изображения
  - Использовать `useFavorites` composable

---

## 🎨 UI/UX Спецификация

### Цветовая схема (из variables.sass)

```sass
$primary-color: #e60023      // Акцентные кнопки
$gray-50: #f9fafb            // Фон страницы
$gray-200: #e5e7eb           // Границы
$gray-500: #6b7280           // Вторичный текст
$text-light: #111827         // Основной текст
$error-color: #dc2626        // Опасная зона
```

### Layout страницы профиля

```
┌─────────────────────────────────────────────────────────┐
│                      HEADER                              │
│  ┌──────┐  Имя пользователя                             │
│  │Avatar│  email@example.com                            │
│  └──────┘  Участник с января 2025                       │
│            [Редактировать]                              │
├─────────────────────────────────────────────────────────┤
│  СТАТИСТИКА                                             │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐                 │
│  │ 12      │  │ 48      │  │ 15      │                 │
│  │ Досок   │  │ Картинок│  │ Избранных│                │
│  └─────────┘  └─────────┘  └─────────┘                 │
├─────────────────────────────────────────────────────────┤
│  [Мои доски]  [Мои изображения]                         │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐                       │
│  │     │ │     │ │     │ │     │                       │
│  │Board│ │Board│ │Board│ │Board│                       │
│  └─────┘ └─────┘ └─────┘ └─────┘                       │
├─────────────────────────────────────────────────────────┤
│  ОПАСНАЯ ЗОНА                                           │
│  [Сменить пароль]  [Удалить аккаунт]                   │
└─────────────────────────────────────────────────────────┘
```

### Mobile Layout (< 768px)

```
┌─────────────────────┐
│      ┌──────┐       │
│      │Avatar│       │
│      └──────┘       │
│   Имя пользователя  │
│   email@example.com │
│   [Редактировать]   │
├─────────────────────┤
│ 12 Досок │ 48 Карт. │
├─────────────────────┤
│ [Доски] [Картинки]  │
│ ┌─────┐ ┌─────┐     │
│ │     │ │     │     │
│ └─────┘ └─────┘     │
├─────────────────────┤
│ [Сменить пароль]    │
│ [Удалить аккаунт]   │
└─────────────────────┘
```

---

## 📝 Типы данных

### Расширение User

```typescript
// types/user.ts
export interface User {
  id: string
  email: string
  username: string
  name?: string           // Добавить
  bio?: string            // Добавить
  avatar?: string
  createdAt: string
  updatedAt?: string      // Добавить
}

export interface UserStats {
  boardsCount: number
  imagesCount: number
  favoritesCount: number
  joinedAt: string
}

export interface UpdateProfileDto {
  name?: string
  bio?: string
}

export interface ChangePasswordDto {
  currentPassword: string
  newPassword: string
}
```

---

## ⚠️ Важные замечания

1. **Использовать Base* компоненты** - все формы и кнопки через `CommonBaseInput`, `CommonBaseButton` и т.д.

2. **Mock API** - пока нет реального бэкенда, API endpoints возвращают mock данные

3. **Валидация** - клиентская + серверная валидация для всех форм

4. **Безопасность** - удаление аккаунта и смена пароля требуют подтверждения паролем

5. **Адаптивность** - mobile-first подход, тестировать на всех размерах экрана

---

## 🔗 Зависимости

- `store/auth.ts` - расширить для updateProfile
- `composables/useFavorites.ts` - для подсчёта избранного
- `store/boards.ts` - для получения досок пользователя
- `components/board/Card.vue` - для отображения досок
- `components/image/MasonryGrid.vue` - для отображения изображений

---

## ✅ Критерии завершения

1. [x] Страница профиля отображает все данные пользователя
2. [x] Аватар можно загрузить и изменить
3. [x] Профиль можно редактировать с валидацией
4. [x] Вкладки показывают доски и изображения пользователя
5. [x] Смена пароля работает через модальное окно
6. [x] Удаление аккаунта работает с подтверждением
7. [x] Адаптивный дизайн на всех устройствах
8. [x] Все компоненты используют Base* из common/
9. [x] Нет ошибок в консоли браузера
